<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Writing Koji Code &mdash; Koji alpha documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Unit tests in Fedora’s Jenkins" href="configuring_jenkins.html" />
    <link rel="prev" title="Koji Content Generator Metadata" href="content_generator_metadata.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Koji
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Operations%20Guide/index.html">Operations Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Administration%20Guide/index.html">Administration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../User%20Guide/index.html">User Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Developer Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="basic_client.html">Basic Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="profiles.html">Koji Profiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="writing_a_plugin.html">Writing Koji plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="content_generators.html">Koji Content Generators</a></li>
<li class="toctree-l2"><a class="reference internal" href="content_generator_metadata.html">Koji Content Generator Metadata</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Writing Koji Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#getting-started-hacking-on-koji">Getting Started Hacking on Koji</a></li>
<li class="toctree-l3"><a class="reference internal" href="#task-flow">Task Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#component-overview">Component Overview</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#koji-client">Koji-client</a></li>
<li class="toctree-l4"><a class="reference internal" href="#koji-hub">Koji-Hub</a></li>
<li class="toctree-l4"><a class="reference internal" href="#kojid">Kojid</a></li>
<li class="toctree-l4"><a class="reference internal" href="#koji-web">Koji-Web</a></li>
<li class="toctree-l4"><a class="reference internal" href="#kojira">Kojira</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#building-and-deploying-changes">Building and Deploying Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#writing-koji-plugins">Writing Koji plugins</a><ul>
<li class="toctree-l4"><a class="reference internal" href="writing_a_plugin.html">Writing Koji plugins</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#submitting-changes">Submitting Changes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#partial-work">Partial work</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#unit-tests">Unit Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="#further-testing">Further testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#code-style">Code Style</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="configuring_jenkins.html">Unit tests in Fedora’s Jenkins</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_process.html">Release process</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../runs_here.html">Runs Here</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Koji</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Developer Guide</a> &raquo;</li>
      <li>Writing Koji Code</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/Developer Guide/writing_koji_code.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="writing-koji-code">
<h1>Writing Koji Code<a class="headerlink" href="#writing-koji-code" title="Permalink to this headline"></a></h1>
<div class="section" id="getting-started-hacking-on-koji">
<h2>Getting Started Hacking on Koji<a class="headerlink" href="#getting-started-hacking-on-koji" title="Permalink to this headline"></a></h2>
<p>This page gives an overview of the Koji code and then describes what
needs to change if you want to add a new type of task. A new task could
be for a new content type, or assembling the results of multiple builds
together, or something else that helps your workflow. New contributors
to Koji should leave this page knowing where to begin and have enough
understanding of Koji’s architecture to be able to estimate how much
work is still ahead of them.</p>
<p>Koji is written to support a variety of platforms and python versions,
with some portions of Koji supported over a larger set than others.
When making changes, please be considerate of those
<a class="reference internal" href="../Operations%20Guide/supported_platforms.html#supported-platforms"><span class="std std-ref">Supported Platforms</span></a>.</p>
</div>
<div class="section" id="task-flow">
<h2>Task Flow<a class="headerlink" href="#task-flow" title="Permalink to this headline"></a></h2>
<p>A task starts with a user submitting it with the Koji client, which is a
command line interface. This contacts the hub, an apache-based server
application. It leaves a row in the database that represents a “free”
task, one that has not been assigned to a builder. Periodically, the
builders asynchronously ping the hub asking if there are any tasks
available, and at some point one will be given the new task. The hub
marks this in the database, and the builder begins executing the task (a
build).</p>
<p>Upon completion, the builder uploads the results to the hub, including
logs, binaries, environment information, and whatever else the task
handler for the build dictated. The hub moves the results to a permanent
shared storage solution, and marks the task as completed (or failed).
During this whole time, the webUI can be used to check up on progress.
So the flow of work is:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Client -&gt; Hub -&gt; Builder -&gt; Hub
</pre></div>
</div>
<p>If you wanted to add a new build type or task that was tightly
integrated in Koji’s data model, you would need to modify the CLI, Hub,
Builder, and WebUI at a minimum. Alternatively, you could do this with a
plugin, which is far simpler but less flexible.</p>
</div>
<div class="section" id="component-overview">
<h2>Component Overview<a class="headerlink" href="#component-overview" title="Permalink to this headline"></a></h2>
<p>Koji is comprised of several components, this section goes into details
for each one, and what you potentially may need to change. Every
component is written in Python, so you will need to know that language
beyond a beginner level.</p>
<div class="section" id="koji-client">
<h3>Koji-client<a class="headerlink" href="#koji-client" title="Permalink to this headline"></a></h3>
<p>koji-client is a command line interface that provides many hooks into
Koji. It allows the user to query much of the data as well as perform
actions such as adding users and initiating build requests.</p>
<div class="section" id="option-handling">
<h4>Option Handling<a class="headerlink" href="#option-handling" title="Permalink to this headline"></a></h4>
<p>The code is in <code class="docutils literal notranslate"><span class="pre">cli/koji</span></code>. It uses <code class="docutils literal notranslate"><span class="pre">OptionParsers</span></code> extensively with
interspersed arguments disabled. That means these two commands are not
interpreted the same:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>koji -u admin -p password tag-build some-tag --force some-build
<span class="gp">$ </span>koji tag-build -u admin -p password some-tag --force some-build
</pre></div>
</div>
<p>The second one will generate an error, because -u and -p are not options
for tag-build, they must show up before that because they are global
options that can be used with any subcommand. There will be two
<code class="docutils literal notranslate"><span class="pre">OptionParsers</span></code> used with each command. The first is used to pick up
arguments to <code class="docutils literal notranslate"><span class="pre">koji</span></code> itself, and the second for the subcommand
specified. When the first one executes (see <code class="docutils literal notranslate"><span class="pre">get_options()</span></code>) it will
figure out the subcommand and come up with a function name based on it.</p>
<p>The convention is to prepend the word <code class="docutils literal notranslate"><span class="pre">handle_</span></code> before it, and change
all hyphens to underscores. If a command does not require an account
with Koji, the function handle will prepended with <code class="docutils literal notranslate"><span class="pre">anon_handle_</span></code>
instead. The code will dynamically call the derived function handle
which is where the second <code class="docutils literal notranslate"><span class="pre">OptionParser</span></code> is used to parse the
remaining options. To have your code log into Koji (you’re writing a
handle_ function), use the <code class="docutils literal notranslate"><span class="pre">activate_session</span></code> function. All function
signatures in the client code will get a session object, which is your
interface to the hub.</p>
</div>
<div class="section" id="profiles">
<h4>Profiles<a class="headerlink" href="#profiles" title="Permalink to this headline"></a></h4>
<p>It is possible to run the Koji client with different configuration
profiles so that you can interact with multiple Koji instances easily.
The <code class="docutils literal notranslate"><span class="pre">--profile</span></code> option to the Koji command itself enables this. You
should have a <code class="docutils literal notranslate"><span class="pre">~/.koji/config</span></code> already, if not just copy from
<code class="docutils literal notranslate"><span class="pre">/etc/koji.conf</span></code> to get a start. The profile command accepts an
argument that matches a section in that config file. So if your config
file had this:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[Fedora]</span>
<span class="na">authtype</span> <span class="o">=</span> <span class="s">ssl</span>
<span class="na">server</span> <span class="o">=</span> <span class="s">https://koji.fedoraproject.org/kojihub</span>
<span class="na">topdir</span> <span class="o">=</span> <span class="s">/mnt/koji</span>
<span class="na">weburl</span> <span class="o">=</span> <span class="s">https://koji.fedoraproject.org/koji</span>
<span class="c1">#pkgurl = https://koji.fedoraproject.org/packages</span>
<span class="na">cert</span> <span class="o">=</span> <span class="s">~/.fedora.cert</span>
<span class="na">ca</span> <span class="o">=</span> <span class="s">~/.fedora-upload-ca.cert</span>
<span class="na">serverca</span> <span class="o">=</span> <span class="s">~/.fedora-server-ca.cert</span>

<span class="k">[MyKoji]</span>
<span class="na">server</span> <span class="o">=</span> <span class="s">https://koji.mydomain.com/kojihub</span>
<span class="na">authtype</span> <span class="o">=</span> <span class="s">kerberos</span>
<span class="na">topdir</span> <span class="o">=</span> <span class="s">/mnt/koji</span>
<span class="na">weburl</span> <span class="o">=</span> <span class="s">https://koji.mydomain.com/koji</span>
<span class="na">topurl</span> <span class="o">=</span> <span class="s">https://download.mydomain.com/kojifiles</span>
</pre></div>
</div>
<p>you could pass Fedora or MyKoji to –profile.</p>
</div>
<div class="section" id="creating-tasks">
<h4>Creating Tasks<a class="headerlink" href="#creating-tasks" title="Permalink to this headline"></a></h4>
<p>Once options are processed and understood, a task needs to be created on
the hub so that a builder can come along and take it. This is
accomplished with the <code class="docutils literal notranslate"><span class="pre">makeTask</span></code> method (defined on the Hub, so call
it on the <code class="docutils literal notranslate"><span class="pre">session</span></code> object). The name of the task should match the
name given to the task handler in the builder, which is explained later
on.</p>
<p>Be sure to process the channel, priority, background, and watch/nowatch
parameters too, which should be available to most new tasks. They’ll be
buried in the first argument to your handler function, which captures
the options passed to the base Koji command.</p>
<p>If the client needs to make locally-available artifacts (config files,
sources, kickstarts) accessible to the builder, it must be uploaded to
the hub. This is the case with uploading SRPMs or kickstarts. You can
easily upload this content with the <code class="docutils literal notranslate"><span class="pre">session.uploadWrapper</span></code> method.
You can create progress bars as necessary with this snippet:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">_running_in_bg</span><span class="p">()</span> <span class="ow">or</span> <span class="n">task_opts</span><span class="o">.</span><span class="n">noprogress</span><span class="p">:</span>
  <span class="n">callback</span> <span class="o">=</span> <span class="kc">None</span>
<span class="k">else</span><span class="p">:</span>
  <span class="n">callback</span> <span class="o">=</span> <span class="n">_progress_callback</span>
<span class="n">serverdir</span> <span class="o">=</span> <span class="n">unique_path</span><span class="p">(</span><span class="s1">&#39;cli-image&#39;</span><span class="p">)</span>   <span class="c1"># create a unique path on the hub</span>
<span class="n">session</span><span class="o">.</span><span class="n">uploadWrapper</span><span class="p">(</span><span class="n">somefile</span><span class="p">,</span> <span class="n">serverdir</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="task-arguments">
<h4>Task Arguments<a class="headerlink" href="#task-arguments" title="Permalink to this headline"></a></h4>
<p>If you define a new task for Koji, you’ll want the task submission
output to have the options ordered usefully. This output is
automatically generated, but sometimes it does not capture the more
important arguments you want displayed.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Created task 10001810
Watching tasks (this may be safely interrupted)...
10001810 thing (noarch): free
10001810 thing (noarch): free -&gt; closed
  0 free  0 open  1 done  0 failed

10001810 thing (noarch) completed successfully
</pre></div>
</div>
<p>In this (fake) example, you can see that “noarch” is the only option
being displayed, but maybe you want something more than just the task
architecture displayed, like some other options that were passed in. You
can fix this behavior in <code class="docutils literal notranslate"><span class="pre">koji/__init__.py</span></code> in the _taskLabel
function. Here you can define the string(s) to display when Koji
receives status on a task. That is the return value.</p>
</div>
<div class="section" id="using-multicall">
<h4>Using multicall<a class="headerlink" href="#using-multicall" title="Permalink to this headline"></a></h4>
<p>Koji supports a multicall feature where many calls are passed to the
server wrapped as a single call. This can reduce the overhead when a
large number of related calls need to be made.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">ClientSession</span></code> class provides support for this and there are several
examples in the existing client code. Some examples in the cli include:
<code class="docutils literal notranslate"><span class="pre">edit-host</span></code>, <code class="docutils literal notranslate"><span class="pre">add-pkg</span></code>, <code class="docutils literal notranslate"><span class="pre">disable-host</span></code>, and <code class="docutils literal notranslate"><span class="pre">list-hosts</span></code>.</p>
<p>There are two ways to use multicall.
The original modal method works within the <code class="docutils literal notranslate"><span class="pre">ClientSession</span></code> object and
prevents making other normal calls until the multicall is completed.
The newer method uses a separate <code class="docutils literal notranslate"><span class="pre">MultiCallSession</span></code> object and is much
more flexible.</p>
<p><strong>Using MultiCallSession</strong></p>
<p>Note: this feature was added in Koji version 1.18.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">MultiCallSession</span></code> object is used to track an individual multicall attached
to a session.
To create one, you can simply call your session’s <code class="docutils literal notranslate"><span class="pre">multicall</span></code> method.
Once created, the object can be used like a session, but calls are stored
rather than sent immediately.
The stored calls are executed by calling the <code class="docutils literal notranslate"><span class="pre">call_all()</span></code> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">multicall</span><span class="p">()</span>
<span class="k">for</span> <span class="n">task_id</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">:</span>
    <span class="n">m</span><span class="o">.</span><span class="n">cancelTask</span><span class="p">(</span><span class="n">task_id</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">call_all</span><span class="p">()</span>
</pre></div>
</div>
<p>This object can also be used as a context manager, so the following is
equivalent:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">multicall</span><span class="p">()</span> <span class="k">as</span> <span class="n">m</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">task_id</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">:</span>
        <span class="n">m</span><span class="o">.</span><span class="n">cancelTask</span><span class="p">(</span><span class="n">task_id</span><span class="p">)</span>
</pre></div>
</div>
<p>Method calls to a <code class="docutils literal notranslate"><span class="pre">MultiCallSession</span></code> object return a <code class="docutils literal notranslate"><span class="pre">VirtualCall</span></code> object
that stands in for the result.
Once the multicall is executed, the result of each call can be accessed via
the <code class="docutils literal notranslate"><span class="pre">result</span></code> property of the <code class="docutils literal notranslate"><span class="pre">VirtualCall</span></code> object.
Accessing the <code class="docutils literal notranslate"><span class="pre">result</span></code> property before the call is executed will result in
an error.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">multicall</span><span class="p">()</span> <span class="k">as</span> <span class="n">m</span><span class="p">:</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">getTag</span><span class="p">(</span><span class="n">tag_id</span><span class="p">)</span> <span class="k">for</span> <span class="n">tag_id</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">]</span>
<span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>There are two parameters affecting the behavior of the multicall.
If the <code class="docutils literal notranslate"><span class="pre">strict</span></code> parameter is set to True, the multicall will raise the first
error it encounters, if any.
If the <code class="docutils literal notranslate"><span class="pre">batch</span></code> parameter is set to a number greater than zero, the multicall
will spread the calls across multiple multicall batches of at most that number.
These parameters may be passed when the <code class="docutils literal notranslate"><span class="pre">MultiCallSession</span></code> is initialized,
or they may be passed to the <code class="docutils literal notranslate"><span class="pre">call_all</span></code> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">multicall</span><span class="p">(</span><span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">batch</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span> <span class="k">as</span> <span class="n">m</span><span class="p">:</span>
    <span class="n">builds</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">getBuild</span><span class="p">(</span><span class="n">build_id</span><span class="p">)</span> <span class="k">for</span> <span class="n">build_id</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">]</span>
</pre></div>
</div>
<p id="multicall"><strong>Using ClientSession.multiCall</strong></p>
<p>Note: this approach is still supported, but we highly recommend using
<code class="docutils literal notranslate"><span class="pre">MultiCallSession</span></code> as described above, unless you need to support Koji
versions prior to 1.18.</p>
<p>To use the feature, you first set the <code class="docutils literal notranslate"><span class="pre">multicall</span></code> attribute of the session
to <code class="docutils literal notranslate"><span class="pre">True</span></code>. Once this is done, the session will not immediately process
further calls but will instead store their parameters for later. To tell the
session to process them, use the <code class="docutils literal notranslate"><span class="pre">multiCall()</span></code> method (note the
capitalization).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">multiCall()</span></code> method returns a list of results, one for each call
in the multicall. Each result with either be:</p>
<ol class="arabic simple">
<li><p>the result of the call wrapped in a singleton list</p></li>
<li><p>a dictionary representing the error raised by the call</p></li>
</ol>
<p>Here is a simple example from the koji-tools package:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">session</span><span class="o">.</span><span class="n">multicall</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">for</span> <span class="n">host</span> <span class="ow">in</span> <span class="n">hosts</span><span class="p">:</span>
    <span class="n">session</span><span class="o">.</span><span class="n">listChannels</span><span class="p">(</span><span class="n">hostID</span><span class="o">=</span><span class="n">host</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
<span class="k">for</span> <span class="n">host</span><span class="p">,</span> <span class="p">[</span><span class="n">channels</span><span class="p">]</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">hosts</span><span class="p">,</span> <span class="n">session</span><span class="o">.</span><span class="n">multiCall</span><span class="p">(</span><span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">)):</span>
    <span class="n">host</span><span class="p">[</span><span class="s1">&#39;channels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">channels</span>
</pre></div>
</div>
<p>Note that when using multicall for informational calls, it is important
to keep track of which result is which. Here we use the existing hosts
list as a unifying index. Python’s <code class="docutils literal notranslate"><span class="pre">zip</span></code> function is useful here.
Also note the unpacking of the singletons.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">multiCall()</span></code> method supports a few options. Here is its signature:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">multiCall</span><span class="p">(</span><span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">batch</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</pre></div>
</div>
<p>If the strict option is set to True, then this method will raise the
first error it encounters, if any.</p>
<p>If the batch option is set to a number greater than zero, the calls
will be spread across multiple multicall batches of at most this
number.</p>
<p>The hub processes multicalls in a <em>single database transaction</em>. Note that if
the <code class="docutils literal notranslate"><span class="pre">batch</span></code> option is used, then each batch is a separate multicall in the
api and therefore a separate transaction.</p>
</div>
</div>
<div class="section" id="koji-hub">
<h3>Koji-Hub<a class="headerlink" href="#koji-hub" title="Permalink to this headline"></a></h3>
<p>koji-hub is the center of all Koji operations. It is an XML-RPC server
running under mod_wsgi in Apache. koji-hub is passive in that it only
receives XML-RPC calls and relies upon the build daemons and other
components to initiate communication. koji-hub is the only component
that has direct access to the database and is one of the two components
that have write access to the file system. If you want to make changes
to the webUI (new pages or themes), you are looking in the wrong
section, there is a separate component for that.</p>
<div class="section" id="implementation-details">
<h4>Implementation Details<a class="headerlink" href="#implementation-details" title="Permalink to this headline"></a></h4>
<p>The <strong>hub/kojihub.py</strong> file is where the server-side code lives. If you
need to fix any server problems or want to add any new tasks, you will
need to modify this file. Changes to the database schema will almost
certainly require code changes too. This file gets deployed to
<strong>/usr/share/koji-hub/kojihub.py</strong>, whenever you make changes to that
remember to restart <strong>httpd</strong>. Also there are cases where httpd looks
for an existing .pyc file and takes it as-is, instead of re-compiling it
when the code is changed.</p>
<p>In the code there are two large classes: <strong>RootExports</strong> and
<strong>HostExports</strong>. RootExports exposes methods using XMLRPC for any client
that connects to the server. The Koji CLI makes use of this quite a bit.
If you want to expose a new API to any remote system, add your code
here. The HostExports class does the same thing except it will ensure
the requests are only coming from builders. Attempting to use an API
exposed here with the CLI will fail. If your work requires the builders
to call a new API, you should implement it here. Any other function
defined in this file is inaccessible by remote hosts. It is generally a
good practice to have the exposed APIs do very little work, and pass off
control to internal functions to do the heavy lifting.</p>
</div>
<div class="section" id="database-interactions">
<h4>Database Interactions<a class="headerlink" href="#database-interactions" title="Permalink to this headline"></a></h4>
<p>Database interactions are done with raw query strings, not with any kind
of modern ORM. Consider using context objects from the Koji contexts
library for thread-safe interactions. The database schema is captured in
the <strong>docs</strong> directory in the root of a git clone. A visualization of
the schema is not available at the time of this writing.</p>
<p>If you plan to introduce schema changes, please update both
<code class="docutils literal notranslate"><span class="pre">schema.sql</span></code> and provide a migration script if necessary.</p>
</div>
<div class="section" id="troubleshooting">
<h4>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline"></a></h4>
<p>The hub runs in an Apache service, so you will need to look in Apache
logs for error messages if you are encountering 500 errors or the
service is failing to start. Specifically you want to check in:</p>
<ul class="simple">
<li><p>/var/log/httpd/error_log</p></li>
<li><p>/var/log/httpd/ssl_error_log</p></li>
</ul>
<p>If you need more specific tracebacks and debugging data, consider
changing the debugging setting in <strong>/etc/koji-hub/hub.conf</strong>. Be advised
the hub is very verbose with this setting on, your logs will take up
gigabytes of space within several days.</p>
</div>
</div>
<div class="section" id="kojid">
<h3>Kojid<a class="headerlink" href="#kojid" title="Permalink to this headline"></a></h3>
<p>kojid is the build daemon that runs on each of the build machines. Its
primary responsibility is polling for incoming build requests and
handling them accordingly. Essentially kojid asks koji-hub for work.
Koji also has support for tasks other than building. Creating install
images is one example. kojid is responsible for handling these tasks as
well. kojid uses mock for building. It also creates a fresh buildroot
for every build. kojid is written in Python and communicates with
koji-hub via XML-RPC.</p>
<div class="section" id="id1">
<h4>Implementation Details<a class="headerlink" href="#id1" title="Permalink to this headline"></a></h4>
<p>The daemon runs as a service on a host that is traditionally not the
same as the hub or webUI. This is a good security practice because the
service runs as root, and executes untrusted code to produce builds on a
regular basis. Keeping the Hub separate limits the damage a malicious
package can do to the build system as a whole. For the same reason, the
filesystem that the hub keeps built software on should be mounted
Read-Only on the build host. It should call APIs on the hub that are
exposed through the <code class="docutils literal notranslate"><span class="pre">HostExports</span></code> class in the hub code. Whenever the
builder accepts a task, it forks a process to carry out the build.</p>
<p>An initscript/unit-file is available for kojid, so it can be stopped and
started like a normal service. Remember to do this when you deploy
changes!</p>
<div class="section" id="taskhandlers">
<h5>TaskHandlers<a class="headerlink" href="#taskhandlers" title="Permalink to this headline"></a></h5>
<p>All tasks in kojid have a <code class="docutils literal notranslate"><span class="pre">TaskHandler</span></code> class that defines what to do
when the task is picked up from the hub. The base class is defined in
<code class="docutils literal notranslate"><span class="pre">koji/tasks.py</span></code> where a lot of useful utility methods are available.
An example is <code class="docutils literal notranslate"><span class="pre">uploadFile</span></code>, which is used to upload logs and built
binaries from a completed build to the hub since the shared filesystem
is read only.</p>
<p>The daemon code lives in <code class="docutils literal notranslate"><span class="pre">builder/kojid</span></code>, which is deployed to
/usr/sbin/kojid. In there you’ll notice that each task handler class has
a <code class="docutils literal notranslate"><span class="pre">Methods</span></code> member and <code class="docutils literal notranslate"><span class="pre">_taskWeight</span></code> member. These must be defined,
and the former is used to match the name of a waiting task (on the hub)
with the task handler code to execute. Each task handler object must
have a <code class="docutils literal notranslate"><span class="pre">handler</span></code> method defined, which is the entry point for the
forked process when a builder accepts a task.</p>
<p>Tasks can have subtasks, which is a typical model when a build can be
run on multiple architectures. In this case, developers should write 2
task handlers: one handles the build for exact one architecture, and one
that assembles the results of those tasks into a single build, and sends
status information to the hub. You can think of the latter handler as
the parent task.</p>
<p>All task handler objects have a <code class="docutils literal notranslate"><span class="pre">session</span></code> object defined, which is the
interface to use for communications with the hub. So, parent tasks
should kick off child tasks using the session object’s subtask method
(which is part of HostExports). It should then call <code class="docutils literal notranslate"><span class="pre">self.wait</span></code> with
<code class="docutils literal notranslate"><span class="pre">all=True</span></code> to wait for the results of the child tasks.</p>
<p>Here’s a stub of what a new build task might look like:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BuildThingTask</span><span class="p">(</span><span class="n">BaseTaskHandler</span><span class="p">):</span>
  <span class="n">Methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;thing&#39;</span><span class="p">]</span>
  <span class="n">_taskWeight</span> <span class="o">=</span> <span class="mf">0.5</span>

  <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">arches</span><span class="p">,</span> <span class="n">options</span><span class="p">):</span>
    <span class="n">subtasks</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">arch</span> <span class="ow">in</span> <span class="n">arches</span><span class="p">:</span>
      <span class="n">subtasks</span><span class="p">[</span><span class="n">arch</span><span class="p">]</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">host</span><span class="o">.</span><span class="n">subtask</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;thingArch&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">arch</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">subtasks</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="nb">all</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># parse results and put rows in database</span>
    <span class="c1"># put files in their final resting place</span>
    <span class="k">return</span> <span class="s1">&#39;Build successful&#39;</span>

<span class="k">class</span> <span class="nc">BuildThingArchTask</span><span class="p">(</span><span class="n">BaseTaskHandler</span><span class="p">):</span>
  <span class="n">Methods</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;thingArch&#39;</span><span class="p">]</span>
  <span class="n">_taskWeight</span> <span class="o">=</span> <span class="mf">2.0</span>

  <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">arch</span><span class="p">):</span>
    <span class="c1"># do the build, capture results in a variable</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">uploadFile</span><span class="p">(</span><span class="s1">&#39;/path/to/some/log&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">uploadFile</span><span class="p">(</span><span class="s1">&#39;/path/to/binary/file&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
</div>
<div class="section" id="source-control-managers">
<h5>Source Control Managers<a class="headerlink" href="#source-control-managers" title="Permalink to this headline"></a></h5>
<p>If you your build needs to check out code from a Source Control Manager
(SCM) such as git or subversion, you can use SCM objects defined in
<code class="docutils literal notranslate"><span class="pre">koji/daemon.py</span></code>. They take a specially formed URL as an argument to
the constructor. Here’s an example use. The second line is important, it
makes sure the SCM is in the whitelist of SCMs allowed in
<code class="docutils literal notranslate"><span class="pre">/etc/kojid/kojid.conf</span></code> or in <code class="docutils literal notranslate"><span class="pre">build_from_scm</span></code> section of hub policy.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">scm</span> <span class="o">=</span> <span class="n">SCM</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">scm</span><span class="o">.</span><span class="n">assert_allowed</span><span class="p">(</span><span class="n">allowed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">allowed_scms</span><span class="p">,</span>
                   <span class="n">session</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span>
                   <span class="n">by_config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">allowed_scms_use_config</span><span class="p">,</span>
                   <span class="n">by_policy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">allowed_scms_use_policy</span><span class="p">,</span>
                   <span class="n">policy_data</span><span class="o">=</span><span class="p">{</span>
                       <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">taskinfo</span><span class="p">[</span><span class="s1">&#39;owner&#39;</span><span class="p">],</span>
                       <span class="s1">&#39;channel&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">getChannel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">taskinfo</span><span class="p">[</span><span class="s1">&#39;channel_id&#39;</span><span class="p">],</span>
                                                          <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                       <span class="s1">&#39;scratch&#39;</span><span class="p">:</span> <span class="n">opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;scratch&#39;</span><span class="p">)</span>
                   <span class="p">}))</span>
<span class="n">directory</span> <span class="o">=</span> <span class="n">scm</span><span class="o">.</span><span class="n">checkout</span><span class="p">(</span><span class="s1">&#39;/checkout/path&#39;</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">uploaddir</span><span class="p">,</span> <span class="n">logfile</span><span class="p">)</span>
</pre></div>
</div>
<p>Checking out takes 4 arguments: where to checkout, a session object
(which is how authentication is handled), a directory to upload the log
to, and a string representing the log file name. Using this method Koji
will checkout (or clone) a remote repository and upload a log of the
standard output to the task results.</p>
</div>
<div class="section" id="build-root-objects">
<h5>Build Root Objects<a class="headerlink" href="#build-root-objects" title="Permalink to this headline"></a></h5>
<p>It is encouraged to build software in mock chroots if appropriate. That
way Koji can easily track precise details about the environment in which
the build was executed. In <code class="docutils literal notranslate"><span class="pre">builder/kojid</span></code> a BuildRoot class is
defined, which provides an interface to execute mock commands. Here’s an
example of their use:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">broot</span> <span class="o">=</span> <span class="n">BuildRoot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">,</span> <span class="n">build_tag</span><span class="p">,</span> <span class="n">arch</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</pre></div>
</div>
<p>A session object, task options, and a build tag should be passed in
as-is. You should also specify the architecture and the task ID. If you
ever need to pass in specialized options to mock, look in the
ImageTask.makeImgBuildRoot method to see how they are defined and passed
in to the BuildRoot constructor.</p>
</div>
</div>
<div class="section" id="id2">
<h4>Troubleshooting<a class="headerlink" href="#id2" title="Permalink to this headline"></a></h4>
<p>The daemon writes a log file to <code class="docutils literal notranslate"><span class="pre">/var/log/kojid.log</span></code>. Debugging output
can be turned on in <code class="docutils literal notranslate"><span class="pre">/etc/kojid/kojid.conf</span></code>.</p>
</div>
</div>
<div class="section" id="koji-web">
<h3>Koji-Web<a class="headerlink" href="#koji-web" title="Permalink to this headline"></a></h3>
<p>koji-web is a set of scripts that run in mod_wsgi and use the Cheetah
templating engine to provide a web interface to Koji. It acts as a
client to koji-hub providing a visual interface to perform a limited
amount of administration. koji-web exposes a lot of information and also
provides a means for certain operations, such as cancelling builds.</p>
<p>The web pages are derived from Cheetah templates, the syntax of which
you can read up on
<a class="reference external" href="http://cheetahtemplate.org/users_guide/">here</a>. These
templates are the <code class="docutils literal notranslate"><span class="pre">chtml</span></code> files sitting in <code class="docutils literal notranslate"><span class="pre">www/kojiweb</span></code>. You’ll
notice quickly that these templates are referencing variables, but where
do they come from?</p>
<p>The <code class="docutils literal notranslate"><span class="pre">www/kojiweb/index.py</span></code> file provides them. There are several
functions named after the templates they support, and in each one a
dictionary called <code class="docutils literal notranslate"><span class="pre">values</span></code> is populated. This is how data is gathered
about the task, build, archive, or whatever the page is about. Take your
time with <code class="docutils literal notranslate"><span class="pre">taskinfo.chtml</span></code> in particular, as the conditionals there
have gotten quite long. If you are adding a new task to Koji, you will
need to extend this at a minimum. A new type of build task would require
this, and possibly another that is specific to viewing the archived
information about the build. (taskinfo vs. buildinfo)</p>
<p>If your web page needs to display the contents of a list or dictionary,
use the <code class="docutils literal notranslate"><span class="pre">$printMap</span></code> function to help with that. It is often sensible
to define a function that easily prints options and values in a
dictionary. An example of this is in taskinfo.chtml.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>#def printOpts($opts)
  #if $opts
  &lt;strong&gt;Options:&lt;/strong&gt;&lt;br/&gt;
  $printMap($opts, &#39;&amp;nbsp;&amp;nbsp;&#39;)
  #end if
#end def
</pre></div>
</div>
<p>Finally, if you need to expand the drop-down menus of “method” types
when searching for tasks in the WebUI, you will need to add them to the
<code class="docutils literal notranslate"><span class="pre">_TASKS</span></code> list in <code class="docutils literal notranslate"><span class="pre">www/kojiweb/index.py</span></code>. Add values where
appropriate to <code class="docutils literal notranslate"><span class="pre">_TOPLEVEL_TASKS</span></code> and <code class="docutils literal notranslate"><span class="pre">_PARENT_TASKS</span></code> as well so that
parent-child relationships show up correctly too.</p>
<p>Remember whenever you update a template or index.py, you will need to
deploy and restart apache/httpd!</p>
<div class="section" id="id3">
<h4>Troubleshooting<a class="headerlink" href="#id3" title="Permalink to this headline"></a></h4>
<p>Like the hub, this component is backed by apache, so you should follow
the same techniques for debugging Koji-Web as
<a class="reference external" href="#Troubleshooting">Koji-Hub</a>.</p>
</div>
</div>
<div class="section" id="kojira">
<h3>Kojira<a class="headerlink" href="#kojira" title="Permalink to this headline"></a></h3>
<p>kojira is a daemon that keeps the build root repodata updated. It is
responsible for removing redundant build roots and cleaning up after a
build request is completed.</p>
</div>
</div>
<div class="section" id="building-and-deploying-changes">
<h2>Building and Deploying Changes<a class="headerlink" href="#building-and-deploying-changes" title="Permalink to this headline"></a></h2>
<p>The root of the git clone for Koji code contains a <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> that has
a few targets to make building and deployment a little easier. Among
them are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">tarball</span></code>: create a bz2 tarball that could be consumed in an rpm build</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rpm</span></code>: create Koji rpms. The NVRs will be defined by the spec file,
which is also in the same directory. The results will appear in a
<code class="docutils literal notranslate"><span class="pre">noarch</span></code> directory.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">test-rpm</span></code>: like rpm, but append the Release field with a date and time
stamp for easy upgrade-deployment</p></li>
</ul>
</div>
<div class="section" id="writing-koji-plugins">
<h2>Writing Koji plugins<a class="headerlink" href="#writing-koji-plugins" title="Permalink to this headline"></a></h2>
<div class="toctree-wrapper compound">
</div>
<p>There is a separate documentation page <a class="reference internal" href="writing_a_plugin.html"><span class="doc">Writing Koji plugins</span></a>.</p>
</div>
<div class="section" id="submitting-changes">
<h2>Submitting Changes<a class="headerlink" href="#submitting-changes" title="Permalink to this headline"></a></h2>
<p>To submit code changes for Koji, please file a pull request in Pagure.</p>
<p><a class="reference external" href="https://pagure.io/koji/pull-requests">https://pagure.io/koji/pull-requests</a></p>
<p>Here are some guidelines on producing preferable pull requests.</p>
<ul>
<li><p>Each request should be a coherent whole, e.g. a single feature or bug fix.
Please do not bundle a series of unrelated changes into a single PR</p></li>
<li><p>Pull requests in Pagure come from a branch in your personal fork of Koji
(either in Pagure or a remote git repo). Please use an appropriately named
branch for this. Do not use the master branch of your fork. Also, please
be aware that Pagure will automatically update the pull request if you
modify the source branch</p></li>
<li><p>Your branch should be based against the current HEAD of the target branch</p></li>
<li><p>Please adhere to <a class="reference external" href="https://www.python.org/dev/peps/pep-0008/">PEP8</a>.
While much of the older code in Koji does not, we try to stick to it
with new code</p></li>
<li><p>Code which is imported into CLI or needed for stand-alone API calls must
run in both 2.6+ and 3.x python versions. We use the python-six library
for compatibility. The affected files are:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cli/*</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">koji/__init__.py</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">koji/auth.py</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">koji/tasks.py</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">koji/util.py</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tests/test_lib/*</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tests/test_cli/*</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p>Check, that unit tests are not broken. Simply run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test</span></code> in main
directory of your branch to check both python2/3 compatible-code. Or you can
also use <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test2</span></code> or <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test3</span></code> target for each of them.</p></li>
</ul>
<p>Note that the core development team for Koji is small, so it may take a few
days for someone to reply to your request.</p>
<div class="section" id="partial-work">
<h3>Partial work<a class="headerlink" href="#partial-work" title="Permalink to this headline"></a></h3>
<p>Pull requests are for changes that are complete and ready for inclusion, but
sometimes you have partial work that you may want feedback on. Please don’t
submit a PR before your code is complete.</p>
<p>The preferred way to request early feedback is to push your changes to a your
own koji fork and then send an email to
<a class="reference external" href="https://lists.fedorahosted.org/mailman/listinfo/koji-devel">koji-devel AT lists.fedorahosted.org</a>
requesting review. This approach is one step short of a PR, making it easy to
upgrade to a PR once the changes are ready.</p>
</div>
</div>
<div class="section" id="unit-tests">
<h2>Unit Tests<a class="headerlink" href="#unit-tests" title="Permalink to this headline"></a></h2>
<p>Koji comes with a small test suite, that you should always run when making
changes to the code. To do so, just run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">test3</span></code> in your terminal.</p>
<p>You will need to install <code class="docutils literal notranslate"><span class="pre">tox</span></code> to actually run the tests.</p>
<p>Please note that it is currently not supported to use <em>virtualenv</em> directly when
hacking on Koji. Only tests are expected to run there.</p>
<p>Unit tests are run automatically for any commit in master branch. We use
Fedora’s jenkins instance for that. Details are given here: <a class="reference internal" href="configuring_jenkins.html"><span class="doc">Unit tests
in Fedora’s Jenkins</span></a>.</p>
</div>
<div class="section" id="further-testing">
<h2>Further testing<a class="headerlink" href="#further-testing" title="Permalink to this headline"></a></h2>
<p>Currently we automatically build two versions of rpms in Fedora’s <a class="reference external" href="https://copr.fedorainfracloud.org/">Copr</a>. First one is simple “master” branch and
is available <a class="reference external" href="https://copr.fedorainfracloud.org/coprs/tkopecek/koji/">here</a>.
These RPMs are early release candidates before we tag each final release. Second
one lives <a class="reference external" href="https://copr.fedorainfracloud.org/coprs/tkopecek/koji-testing/">here</a> and contains
the “master” branch with all the in-progress pull requests that have
“testing-ready” flag. Both repos are built once per four hours if there are new
changes in pagure.</p>
</div>
<div class="section" id="code-style">
<h2>Code Style<a class="headerlink" href="#code-style" title="Permalink to this headline"></a></h2>
<p>We are using <code class="docutils literal notranslate"><span class="pre">flake8</span></code> to check the code style. Please refer to <code class="docutils literal notranslate"><span class="pre">.flake8</span></code> to
find the PEP8 and extra rules we are following/ignoring.</p>
<p>You will need to install the packages below to run the check.</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">python-flake8</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">python-flake8-import-order</span></code></p></li>
</ul>
</div></blockquote>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="content_generator_metadata.html" class="btn btn-neutral float-left" title="Koji Content Generator Metadata" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="configuring_jenkins.html" class="btn btn-neutral float-right" title="Unit tests in Fedora’s Jenkins" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, Mike McLean, Mike B, Dennis Gilmore, Mathieu Bridon, Ian McLeod, Ralph Bean, Adam Miller.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>