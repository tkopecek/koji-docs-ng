<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CVE-2018-1002150 &mdash; Koji alpha documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="FAQ for CVE-2018-1002150" href="CVE-2018-1002150-FAQ.html" />
    <link rel="prev" title="FAQ for CVE-2018-1002161" href="CVE-2018-1002161-FAQ.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Koji
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Operations Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../server_howto.html">Server Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../server_bootstrap.html">Koji Server Bootstrap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../external_repo_server_bootstrap.html">External Repository Server Bootstrap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kerberos_gssapi_debug.html">Koji Kerberos/GSSAPI debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kojid_conf.html">kojid.conf Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hub_conf.html">hub.conf options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database_howto.html">Database Performance Howto</a></li>
<li class="toctree-l2"><a class="reference internal" href="../image_build.html">Building Images in Koji</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins.html">Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../supported_platforms.html">Supported Platforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tasks.html">Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils.html">Koji Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../volumes.html">Storage Volumes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../containers.html">Running Koji in Containers</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../releases.html">Releases</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="CVEs.html">Koji CVEs</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="CVE-2020-15856.html">CVE-2020-15856</a></li>
<li class="toctree-l4"><a class="reference internal" href="CVE-2019-17109.html">CVE-2019-17109</a></li>
<li class="toctree-l4"><a class="reference internal" href="CVE-2018-1002161.html">CVE-2018-1002161</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">CVE-2018-1002150</a></li>
<li class="toctree-l4"><a class="reference internal" href="CVE-2017-1002153.html">CVE-2017-1002153</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../migrations/migrations.html">Migrations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../release_notes/release_notes.html">Release Notes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../Administration%20Guide/index.html">Administration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../User%20Guide/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Developer%20Guide/index.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../HOWTO.html">Koji HOWTO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc.html">Koji Miscellaneous Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../runs_here.html">Runs Here</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Koji</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Operations Guide</a> &raquo;</li>
          <li><a href="../releases.html">Releases</a> &raquo;</li>
          <li><a href="CVEs.html">Koji CVEs</a> &raquo;</li>
      <li>CVE-2018-1002150</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/Operations Guide/CVEs/CVE-2018-1002150.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="cve-2018-1002150">
<h1>CVE-2018-1002150<a class="headerlink" href="#cve-2018-1002150" title="Permalink to this headline"></a></h1>
<p>Dist repo call missing authorization check allowing filesystem manipulation</p>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline"></a></h2>
<p>This is a critical security bug.</p>
<p>From versions 1.12.0 to 1.15.0, the Koji hub did not perform proper
access checks for the hub.distRepoMove call. By passing carefully
constructed arguments to the call, an unauthenticated user can trick
Koji into moving content around that it should not. This could result in
corrupting any files that the httpd process can write to, or revealing
any files that the httpd process can read. If the user can authenticate
(at any privilege level), then they can use this mechanism to replace a
file with one that they have uploaded.</p>
</div>
<div class="section" id="workaround">
<h2>Workaround<a class="headerlink" href="#workaround" title="Permalink to this headline"></a></h2>
<p><em>We strongly recommend that all Koji admins implement this workaround
immediately.</em> This workaround will effectively disable dist-repo
functionality.</p>
<p>Because use of the hub.distRepoMove call requires a valid dist repo that
exists on disk, exploitation can be blocked by ensuring that there are
none. There are many ways this might be done. We recommend the
following:</p>
<ol class="arabic simple">
<li><p>Move the repos-dist directory to another location (if it exists)</p></li>
<li><p>Replace it with a plain text file warning of the situation. Do not
skip this step.</p></li>
</ol>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd /mnt/koji
$ mv repos-dist repos-dist.old
$ echo &quot;DO NOT REMOVE. CVE-2018-1002150&quot; &gt; repos-dist
$ ls -l /mnt/koji/repos-dist
-rw-r--r--. 1 root root 32 Mar 19 14:35 /mnt/koji/repos-dist
</pre></div>
</div>
<p>When applying this workaround, make sure to take both steps. If you do
not, then the system will recreate the directory if anyone creates
a new dist repo.</p>
</div>
<div class="section" id="bug-fix">
<h2>Bug fix<a class="headerlink" href="#bug-fix" title="Permalink to this headline"></a></h2>
<p><em>Note: because code fixes can take time to deploy, we strongly recommend
that all admins apply the above workaround first. The workaround can be
easily undone once the fix is in place.</em></p>
<p>We are releasing updates for each affected version of Koji to fix this
bug. The following <a class="reference external" href="https://pagure.io/koji/releases">releases</a> all
contain the fix:</p>
<ul class="simple">
<li><p>1.15.1</p></li>
<li><p>1.14.1</p></li>
<li><p>1.13.1</p></li>
<li><p>1.12.1</p></li>
</ul>
<p>Versions prior to 1.12.0 are not vulnerable because they do not have the
dist-repo feature. Also, the legacy-py24 branch is unaffected since it
is client-only (no hub).</p>
<p>For users who have customized their Koji code, we recommend rebasing
your work onto the appropriate update release. If this is not feasible,
the patch should be very easy to apply. Please see <a class="reference external" href="https://pagure.io/koji/issue/850">issue
#850</a> for the code details.</p>
<p>As with all changes to hub code, you must restart httpd for the changes
to take effect.</p>
</div>
<div class="section" id="links">
<h2>Links<a class="headerlink" href="#links" title="Permalink to this headline"></a></h2>
<p>Fixed versions can be found at our releases page:</p>
<blockquote>
<div><p><a class="reference external" href="https://pagure.io/koji/releases">https://pagure.io/koji/releases</a></p>
</div></blockquote>
<p>Questions and answers about this issue</p>
<blockquote>
<div><p><a class="reference internal" href="CVE-2018-1002150-FAQ.html"><span class="doc">FAQ for CVE-2018-1002150</span></a></p>
</div></blockquote>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="CVE-2018-1002161-FAQ.html" class="btn btn-neutral float-left" title="FAQ for CVE-2018-1002161" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="CVE-2018-1002150-FAQ.html" class="btn btn-neutral float-right" title="FAQ for CVE-2018-1002150" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, Mike McLean, Mike B, Dennis Gilmore, Mathieu Bridon, Ian McLeod, Ralph Bean, Adam Miller.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>