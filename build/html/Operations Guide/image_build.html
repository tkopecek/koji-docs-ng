<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Building Images in Koji &mdash; Koji alpha documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Plugins" href="plugins.html" />
    <link rel="prev" title="Database Performance Howto" href="database_howto.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Koji
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Operations Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="server_howto.html">Server Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="server_bootstrap.html">Koji Server Bootstrap</a></li>
<li class="toctree-l2"><a class="reference internal" href="external_repo_server_bootstrap.html">External Repository Server Bootstrap</a></li>
<li class="toctree-l2"><a class="reference internal" href="kerberos_gssapi_debug.html">Koji Kerberos/GSSAPI debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="kojid_conf.html">kojid.conf Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="hub_conf.html">hub.conf options</a></li>
<li class="toctree-l2"><a class="reference internal" href="database_howto.html">Database Performance Howto</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Building Images in Koji</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#image-building">Image Building</a></li>
<li class="toctree-l3"><a class="reference internal" href="#kickstart-first">Kickstart First</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#kickstart-reference">Kickstart Reference</a></li>
<li class="toctree-l4"><a class="reference internal" href="#getting-your-kickstart-to-koji">Getting your Kickstart to Koji</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#building-livemedias">Building LiveMedias</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#getting-started">Getting Started</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mechanics">Mechanics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#caveats-for-livemedias">Caveats for LiveMedias</a></li>
<li class="toctree-l4"><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build-system-preparation">Build System Preparation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#building-disk-images">Building Disk Images</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id2">Getting Started</a></li>
<li class="toctree-l4"><a class="reference internal" href="#ova-features">OVA Features</a></li>
<li class="toctree-l4"><a class="reference internal" href="#kickstart-preparation">Kickstart Preparation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id4">Build System Preparation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#building-appliances">Building Appliances</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id5">Getting Started</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id6">Mechanics</a></li>
<li class="toctree-l4"><a class="reference internal" href="#caveats-for-appliances">Caveats for Appliances</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id7">Troubleshooting</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id8">Build System Preparation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="plugins.html">Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="supported_platforms.html">Supported Platforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="tasks.html">Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.html">Koji Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="volumes.html">Storage Volumes</a></li>
<li class="toctree-l2"><a class="reference internal" href="containers.html">Running Koji in Containers</a></li>
<li class="toctree-l2"><a class="reference internal" href="releases.html">Releases</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Administration%20Guide/index.html">Administration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../User%20Guide/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Developer%20Guide/index.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../HOWTO.html">Koji HOWTO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc.html">Koji Miscellaneous Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../runs_here.html">Runs Here</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Koji</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Operations Guide</a> &raquo;</li>
      <li>Building Images in Koji</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/Operations Guide/image_build.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="building-images-in-koji">
<h1>Building Images in Koji<a class="headerlink" href="#building-images-in-koji" title="Permalink to this headline"></a></h1>
<div class="section" id="image-building">
<h2>Image Building<a class="headerlink" href="#image-building" title="Permalink to this headline"></a></h2>
<p>Koji is capable of building many different types of images or appliances. They
broadly fall into a few categories: LiveMedias, Disk Images, and Containers. All
types of images end up with a Name-Version-Release just like an RPM build.  What
you need to provide Koji to perform a build varies by category, and the
specifics will be explained below.</p>
<p>For additional questions and information, ask around in <code class="docutils literal notranslate"><span class="pre">#koji</span></code> on FreeNode
IRC and sign up to the right mailing lists as the <a class="reference external" href="https://fedorahosted.org/koji/wiki">Koji project website</a>
dictates.</p>
</div>
<div class="section" id="kickstart-first">
<h2>Kickstart First<a class="headerlink" href="#kickstart-first" title="Permalink to this headline"></a></h2>
<p>No matter which type of image you want to build, you need to feed Koji a
<a class="reference external" href="https://github.com/rhinstaller/pykickstart/blob/master/docs/kickstart-docs.rst">kickstart</a> file, so we touch on how to create them and how to get them to Koji
first. Once you have a kickstart to try out, look over the kickstart-specific
caveats for each image type in the later sections.</p>
<div class="section" id="kickstart-reference">
<h3>Kickstart Reference<a class="headerlink" href="#kickstart-reference" title="Permalink to this headline"></a></h3>
<p>If you’re new to automated installations, you should read the <a class="reference external" href="https://github.com/rhinstaller/pykickstart/blob/master/docs/kickstart-docs.rst">Anaconda
Kickstart Guide</a> first.</p>
</div>
<div class="section" id="getting-your-kickstart-to-koji">
<h3>Getting your Kickstart to Koji<a class="headerlink" href="#getting-your-kickstart-to-koji" title="Permalink to this headline"></a></h3>
<p>For scratch builds, you can get away with just using the <code class="docutils literal notranslate"><span class="pre">--kickstart</span></code>
parameter, which accepts a path (relative or absolute) to your kickstart file
on disk. For non-scratch builds though, the kickstart file needs to live in a
remote Source Control Manager (SCM) such as git or Subversion. To access that,
you need to pass the <code class="docutils literal notranslate"><span class="pre">--ksurl</span></code> parameter, which accepts a wacky string in
this form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>git://git.fedorahosted.org/git/spin-kickstarts.git?fedora22#68c40eb7
</pre></div>
</div>
<p>Here we pointed to a repository hosted at
<code class="docutils literal notranslate"><span class="pre">git://git.fedorahosted.org/git/spin-kickstarts.git</span></code>. Note the <code class="docutils literal notranslate"><span class="pre">?</span></code> in
there, this delimiter separates the host URL with a directory structure to
look in for the kickstart file. In other words, if you were to clone the
repository, you should expect to see these (sub)directories laid out below the
root of the clone. The important thing to realize is the behavior of
<code class="docutils literal notranslate"><span class="pre">--kickstart</span></code> changes if <code class="docutils literal notranslate"><span class="pre">--ksurl</span></code> is specified. Instead of indicating a
path to a kickstart file, you just indicate a filename. The file itself is not
specified in the fragment of the string between <code class="docutils literal notranslate"><span class="pre">?</span></code> and <code class="docutils literal notranslate"><span class="pre">#</span></code> that is passed
to <code class="docutils literal notranslate"><span class="pre">--ksurl</span></code>, Koji still uses the <code class="docutils literal notranslate"><span class="pre">--kickstart</span></code> option for that. After the
directory structure comes a <code class="docutils literal notranslate"><span class="pre">#</span></code>, which indicates the start of the commit ID.
This is the commit Koji will reset the repository to after cloning. If you
created a git repository which had just the spec file template in it, your SCM
URL would have the <code class="docutils literal notranslate"><span class="pre">?</span></code> and <code class="docutils literal notranslate"><span class="pre">#</span></code> right next to each other.</p>
<p>If we passed <code class="docutils literal notranslate"><span class="pre">--ksurl</span></code> the string above, and gave
<code class="docutils literal notranslate"><span class="pre">--kickstart</span> <span class="pre">&quot;server-ec2.ks&quot;</span></code>, then Koji would do the following:</p>
<ul class="simple">
<li><p>Clone the repository locally</p></li>
<li><p>Call <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">reset</span> <span class="pre">--hard</span> <span class="pre">68c40eb7</span></code></p></li>
<li><p>Search in the “fedora22” subdirectory of the clone for a file called
<code class="docutils literal notranslate"><span class="pre">server-ec2.ks</span></code>, and pass that to Anaconda</p></li>
<li><p>Perform an automated install</p></li>
</ul>
</div>
</div>
<div class="section" id="building-livemedias">
<span id="building-livemedia"></span><h2>Building LiveMedias<a class="headerlink" href="#building-livemedias" title="Permalink to this headline"></a></h2>
<p>Let’s describe building LiveMedias and the mechanics behind it. We also still
suport older method LiveCD which is deprecated now.</p>
<div class="section" id="getting-started">
<h3>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this headline"></a></h3>
<p>What you need before proceeding:</p>
<ul class="simple">
<li><p>a name for your LiveMedia, and a version number</p></li>
<li><p>a Koji build target</p></li>
<li><p>what architectures you want</p></li>
<li><p>a flattened kickstart file</p></li>
<li><p>you may also need yum repositories generated by release engineering if you
require signed packages be installed into the LiveMedia</p></li>
<li><p>the permission for building these in Koji - in default installation permission
is not needed, but in production environments there will be probably some
permission or at least policy in place</p></li>
</ul>
<p>The Koji command that creates a LiveMedia is called <code class="docutils literal notranslate"><span class="pre">spin-livemedia</span></code>. It calls
out to <a class="reference external" href="https://weldr.io/lorax/livemedia-creator.html">livemedia-creator</a> from <a class="reference external" href="https://github.com/weldr/lorax">lorax</a> project in a mock chroot to construct
the LiveMedia. To run a LiveMedia build, use the <code class="docutils literal notranslate"><span class="pre">spin-livemedia</span></code> command like
so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ koji spin-livemedia --release 20200922.n.0  \
                      --ksurl &#39;git+https://pagure.io/fedora-kickstarts.git?#b4956c05028a088c641d0ce6e1a31b6d8b20176f&#39; \
                      --install-tree-url &#39;https://kojipkgs.fedoraproject.org/compose/branched/Fedora-33-20200922.n.0/compose/Everything/$basearch/os&#39; \
                      --repo &#39;https://kojipkgs.fedoraproject.org/compose/branched/Fedora-33-20200922.n.0/compose/Everything/$basearch/os&#39; \
                      --can-fail ppc64le,aarch64 \
                      Fedora-Workstation-Live 33 f33 x86_64,ppc64le,aarch64 fedora-live-workstation.ks
</pre></div>
</div>
<p>In this example (real task is <a class="reference external" href="https://koji.fedoraproject.org/koji/taskinfo?taskID=52013359">here</a>) a LiveMedia will
be created with the N-V-R of <code class="docutils literal notranslate"><span class="pre">Fedora-Workstation-Live-33-20200922.n.0</span></code>. If
<code class="docutils literal notranslate"><span class="pre">--release</span></code> was not included an incrementing value would be computed by Koji
instead. spin-livemedia takes a minimum of 4 arguments:</p>
<dl class="simple">
<dt>Name</dt><dd><p>the name of the image, without versioning information. Examples could be
<code class="docutils literal notranslate"><span class="pre">Fedora-Live</span></code> or <code class="docutils literal notranslate"><span class="pre">Fedora-Workstation-Live</span></code>.</p>
</dd>
<dt>Version</dt><dd><p>an arbitrary version string. For Fedora images, this usually matches the
release version, such as 31, 32, or 33.</p>
</dd>
<dt>Build Target</dt><dd><p>just like RPM builds Koji must be told which target to use. This controls
what tag the image will be tagged into, and what packages are available to
install into the image.</p>
</dd>
<dt>Kickstart File</dt><dd><p>this is a recipe file that performs drives the construction of the image.
Note, that you’re can either upload your kickstart or just point to some SCM
(<code class="docutils literal notranslate"><span class="pre">--ksurl</span></code>).  In our example fedora repo contains
<code class="docutils literal notranslate"><span class="pre">fedora-live-workstation.ks</span></code> kickstart file.</p>
</dd>
</dl>
<p>Use <code class="docutils literal notranslate"><span class="pre">--help</span></code> to discover more options to <code class="docutils literal notranslate"><span class="pre">spin-livemedia</span></code>. You can override
the Release field with <code class="docutils literal notranslate"><span class="pre">--release</span></code>, or <code class="docutils literal notranslate"><span class="pre">--repo</span></code> to override what yum repo is
used to provide packages to install to the image. Note that regardless of what
repo you use, it must contain RPMs built by Koji, otherwise you will get an
error. (unless you are building a scratch image). <code class="docutils literal notranslate"><span class="pre">--can-fail</span></code> options says
which architectures are optional and can fail without failing the whole build.</p>
</div>
<div class="section" id="mechanics">
<h3>Mechanics<a class="headerlink" href="#mechanics" title="Permalink to this headline"></a></h3>
<p>The way LiveMedias are created in Koji is fairly straightforward. A chroot is
initialized and populated with the packages and their dependencies from the
<code class="docutils literal notranslate"><span class="pre">livemedia-build</span></code> package group. Next, the kickstart file is copied into it if
it was provided from local storage. If not, it is checked out into it from an
SCM. It is then modified to use the repo associated with the build tag for the
target specified in the command unless the <code class="docutils literal notranslate"><span class="pre">--repo</span></code> option was given. Both the
original and the modified kickstart files are saved as part of the output for
the task for later review. A <a class="reference external" href="https://weldr.io/lorax/livemedia-creator.html">livemedia-creator</a> command is executed using the
<code class="docutils literal notranslate"><span class="pre">mock('--chroot',</span> <span class="pre">...)</span></code> method.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This process runs as root. This produces the desired image which is uploaded
to <code class="docutils literal notranslate"><span class="pre">/mnt/koji/images/&lt;image&gt;/$imageID</span></code> if it is not a scratch image.</p>
</div>
</div>
<div class="section" id="caveats-for-livemedias">
<span id="id1"></span><h3>Caveats for LiveMedias<a class="headerlink" href="#caveats-for-livemedias" title="Permalink to this headline"></a></h3>
<p>There are some known caveats with using the spin-livemedia command that users
should be aware of.</p>
<div class="section" id="include-macros-in-the-kickstart">
<h4>%include macros in the kickstart<a class="headerlink" href="#include-macros-in-the-kickstart" title="Permalink to this headline"></a></h4>
<p>A word of caution about kickstart files and the <code class="docutils literal notranslate"><span class="pre">%include</span></code> macro.
<a class="reference external" href="https://weldr.io/lorax/livemedia-creator.html">livemedia-creator</a> is smart enough to search the current directory of the
submitted kickstart file if it has <code class="docutils literal notranslate"><span class="pre">%include</span></code> macros. If the kickstart
specified to koji is from local storage, only that kickstart file will be copied
into the chroot, and this creates a problem if it has <code class="docutils literal notranslate"><span class="pre">%include</span></code> macros,
because the other kickstart files it needs will be inaccessible. This issue is
not present when the kickstart file is retrieved from a remote SCM (such as the
fedora-kickstarts git repo), because the entire repository is checked out.
Presumably it will include any other kickstart files the specified one is
including in the same directory. A workaround for the issue would be to use
<code class="docutils literal notranslate"><span class="pre">ksflatten</span></code> (from pykickstart) on kickstart files with <code class="docutils literal notranslate"><span class="pre">%include</span></code> macros
that are going to be submitted to koji from the user’s local disk.</p>
</div>
<div class="section" id="package-groups-in-the-kickstart-file">
<h4>Package Groups in the Kickstart File<a class="headerlink" href="#package-groups-in-the-kickstart-file" title="Permalink to this headline"></a></h4>
<p>Package Groups in the kickstart file cause a problem if the Koji repos do not
define them, which they most likely don’t since Koji’s comps.xml is based on the
“groups” set up from the CLI. <a class="reference external" href="https://weldr.io/lorax/livemedia-creator.html">livemedia-creator</a>’s behavior is to ignore
package groups that are not defined in the repo it is using, so this can be
troublesome when creating the image since packages could be left out. There are
a couple possible workarounds:</p>
<ul class="simple">
<li><p>do not use package groups in the kickstart file and just specify a huge list
of packages</p></li>
<li><p>use <code class="docutils literal notranslate"><span class="pre">--repo</span></code> and specify a repo that does have a comps.xml that defines
the groups it uses</p></li>
</ul>
</div>
<div class="section" id="only-include-rpms-built-in-koji">
<h4>Only Include RPMs Built in Koji<a class="headerlink" href="#only-include-rpms-built-in-koji" title="Permalink to this headline"></a></h4>
<p>The image building tasks will fail if your image tries to include a package
that was not built in your build system. This is because the package does not
have any origin information stored in Koji’s database. The repos defined in the
kickstart will automatically be overridden with the repo of the build tag for
the build target, unless you use the <code class="docutils literal notranslate"><span class="pre">--repo</span></code> option. Since only packages
you have built (or include from an external repo) should be there, you should
never have this problem unless you use <code class="docutils literal notranslate"><span class="pre">--repo</span></code>.</p>
</div>
<div class="section" id="no-signed-or-debuginfo-rpms-in-koji-s-build-tags">
<h4>No Signed or Debuginfo RPMs in Koji’s Build Tags<a class="headerlink" href="#no-signed-or-debuginfo-rpms-in-koji-s-build-tags" title="Permalink to this headline"></a></h4>
<p>If you need signed RPMs or debuginfo RPMs, you will run into trouble because
Koji does not keep those in its build tag repos. The only work around for this
is to create a repo yourself that includes these RPMs and then use <code class="docutils literal notranslate"><span class="pre">--repo</span></code>.
This will force the image to take RPMs from that repo. Remember, the task will
fail if Koji detects RPMs were installed that were not built in the build
system.</p>
</div>
<div class="section" id="post-section-in-kickstart">
<h4>%post Section in Kickstart<a class="headerlink" href="#post-section-in-kickstart" title="Permalink to this headline"></a></h4>
<p>While <a class="reference external" href="https://weldr.io/lorax/livemedia-creator.html">livemedia-creator</a> does support building on SELinux disabled hosts, you
can run into denials when booting if you create and use new files in the
<code class="docutils literal notranslate"><span class="pre">%post</span></code> section of your kickstart file. If you do, you should either set the
labels appropriately at the end of the <code class="docutils literal notranslate"><span class="pre">%post</span></code> section, or instigate an
autorelabel at boot time.</p>
</div>
</div>
<div class="section" id="troubleshooting">
<h3>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline"></a></h3>
<p>If your build fails, you will be notified on the command line. In the output
will be a URL to the Koji UI, visit that and click on the red subtask link.
From that page review <code class="docutils literal notranslate"><span class="pre">root.log</span></code> and <code class="docutils literal notranslate"><span class="pre">livemedia-out.log</span></code> for errors. Often
errors are caused by packages being missing, or malformed kickstart files. The
log files are at the bottom of the page. If problem occurs later during
installation <a class="reference external" href="https://weldr.io/lorax/livemedia-creator.html">livemedia-creator</a> will also upload a lot of other logs like
anaconda’s, etc. If you’re stuck, contact Release Engineering.</p>
</div>
<div class="section" id="build-system-preparation">
<h3>Build System Preparation<a class="headerlink" href="#build-system-preparation" title="Permalink to this headline"></a></h3>
<p>This section assumes you have know-how required to install and configure a new
instance of Koji, and that you have already done so. You can learn how to do so
<a class="reference internal" href="server_howto.html"><span class="doc">here</span></a> if you need to. Please ensure you are using the
latest version of the software and that your database schema is updated as
well. You should also have some familiarity with how <a class="reference external" href="https://weldr.io/lorax/livemedia-creator.html">livemedia-creator</a> works.
This section only covers preparation for LiveMedia builds.</p>
<p>Follow this procedure step by step to get things prepared they way they need to
be.</p>
<ol class="arabic simple">
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">koji</span> <span class="pre">add-host-to-channel</span> <span class="pre">&lt;your-host&gt;</span> <span class="pre">livemedia</span></code></dt><dd><p>add a builder to the livemedia channel</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">koji</span> <span class="pre">grant-permission</span> <span class="pre">livemedia</span> <span class="pre">&lt;user&gt;</span></code></dt><dd><p>grant the permission to build an image type to a user. This step is
optional since admins have all permissions.</p>
</dd>
</dl>
</li>
<li><p>You will need a tag and target to build the images from. The yum repo
generated for the build tag of the target is what Koji will use to populate
the LiveMedias with by default. (the alternative is to use the <code class="docutils literal notranslate"><span class="pre">--repo</span></code>
option, more on that later)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">koji</span> <span class="pre">add-group</span> <span class="pre">&lt;build-tag&gt;</span> <span class="pre">livemedia-build</span></code>
add the livemedia-build group</p></li>
<li><dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">koji</span> <span class="pre">add-group-pkg</span> <span class="pre">&lt;build-tag&gt;</span> <span class="pre">livemedia-build</span> <span class="pre">&lt;pkg&gt;</span> <span class="pre">...</span></code></dt><dd><p>add packages to the livemedia-build group. These package lists vary has
packages and dependencies change. As of September, 2020 for Fedora 33 the
needed packages for each image type are:</p>
<ul class="simple">
<li><p>bash, coreutils, glibc-all-langpacks, lorax-lmc-novirt,
selinux-policy-targeted, shadow-utils, util-linux</p></li>
</ul>
</dd>
</dl>
</li>
</ol>
</div>
</div>
<div class="section" id="building-disk-images">
<h2>Building Disk Images<a class="headerlink" href="#building-disk-images" title="Permalink to this headline"></a></h2>
<p>Disk images are files that represent virtual disks. They have a partition table
and filesystems on them, and are available in a variety of formats: qcow2,
vmdk, ova, Hyper-V, raw, “base” container images, and more.</p>
<div class="section" id="id2">
<h3>Getting Started<a class="headerlink" href="#id2" title="Permalink to this headline"></a></h3>
<p>What you need:</p>
<ul class="simple">
<li><p>a name for your image, and a version number</p></li>
<li><p>what architectures you want</p></li>
<li><p>a Koji build target</p></li>
<li><p>kickstart file</p></li>
<li><p>installation tree</p></li>
<li><p>you may also need yum repositories generated by Rel-Eng if you require signed
packages be installed into the image</p></li>
</ul>
<p>The Koji command to build a disk image is called <code class="docutils literal notranslate"><span class="pre">image-build</span></code>. The
<code class="docutils literal notranslate"><span class="pre">image-build</span></code> command uses <a class="reference external" href="http://imgfac.org/">ImageFactory</a> and <a class="reference external" href="https://github.com/clalancette/oz">Oz</a> to start a VM guest and
perform an automated Anaconda installation. Here is a (lengthy) example for
building a disk image.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ koji image-build --repo &#39;https://alt.fedoraproject.org/pub/alt/releases/22/Cloud/$arch/os/&#39; --kickstart fedora-server.ks --scratch --distro Fedora-22 --format qcow2 fedora-server-kvm 22 &#39;https://alt.fedoraproject.org/pub/alt/releases/22/Cloud/$arch/os/&#39; x86_64
</pre></div>
</div>
<p>This example builds a scratch qcow2 disk image using packages from an
additional yum repository. Without this option the yum repo to populate the
build root would be used instead. If this was the first image with the N-V of
fedora-server-kvm-22, then the N-V-R would be fedora-server-kvm-22-1, because
Koji uses an incrementing number for the release if you do not provide one.
Like all Koji commands, use <code class="docutils literal notranslate"><span class="pre">--help</span></code> to see more options that are available.</p>
<p>For Docker, Koji only supports Base Images right now using a kickstart file as
described above. In the future it will support layered images, but not before
some Docker requirements are met, and Koji is maintaining a Registry of its
own. This scoping effort is ongoing.</p>
<p><code class="docutils literal notranslate"><span class="pre">image-build</span></code> takes a minimum of 5 positional arguments, and 2 options must
be specified. They are reviewed in the list below, with the positional
arguments first.</p>
<dl class="simple">
<dt>Name</dt><dd><p>the name of the image, without versioning information. Examples could be
<code class="docutils literal notranslate"><span class="pre">fedora-server</span></code> or <code class="docutils literal notranslate"><span class="pre">fedora-workstation</span></code>.</p>
</dd>
<dt>Version</dt><dd><p>an arbitrary version string. For Fedora images, this usually matches the
release version, such as 22 or 23.</p>
</dd>
<dt>Build Target</dt><dd><p>just like RPM builds Koji must be told which target to use. This controls
what tag the image will be tagged into, and what packages are available to
install into the image.</p>
</dd>
<dt>Installation Tree URL</dt><dd><p>this is a URL to a location you can install an operating system from. It is
the same place you would direct a PXE-booted system to go. In 99% of cases
this location is provided by Release Engineering. It should have an
“isolinux” subdirectory and yum metadata somewhere within.</p>
</dd>
<dt>Architecture</dt><dd><p>only x86_64 or i386 is supported, and you can specify both on the command
line. This will cause two subtasks to be run, allowing you to build for
both arches in parallel. If either fail, the whole build will fail.</p>
</dd>
<dt>Kickstart File</dt><dd><p>this is a recipe file that performs drives the construction of the image.
Pass in the path to a kickstart file, which must be flattened.</p>
</dd>
<dt>Kickstart URL</dt><dd><p>in a non-scratch build, you’ll need this too. For more details, see the
Getting your Kickstart to Koji section.</p>
</dd>
<dt>Distro</dt><dd><p>a string that indicates what OS is being built. These always follow the
convention of “Fedora-X”, where X is the release number.</p>
</dd>
</dl>
<p>Since this command can get very long, a configuration file can drive the task
as well, using the <code class="docutils literal notranslate"><span class="pre">--config</span></code> option. It accepts a path to a configuration
file written in the Python ConfigParser format (like a Windows .ini). The
options are all named the same with one caveat, see below. Here’s what one
could look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[image-build]
name = fedora-server-docker
version = 22
target = f22-candidate
install_tree = https://alt.fedoraproject.org/pub/alt/releases/22/Cloud/$arch/os/
arches = x86_64

format = qcow2,rhevm-ova,vsphere-ova
distro = Fedora-22
repo = https://alt.fedoraproject.org/pub/alt/releases/22/Cloud/$arch/os/
disk_size = 20

ksversion = DEVEL
kickstart = fedora-22-server-docker.ks
ksurl = git://git.fedorahosted.org/git/spin-kickstarts.git?fedora22#68c40eb7
specfile = git://git.fedorahosted.org/git/spin-kickstarts.git?spec_templates/fedora22#68c40eb7
</pre></div>
</div>
<p>A few notes on the syntax:</p>
<ul class="simple">
<li><p>it allows for comments too, the lines start with a hash (#)</p></li>
<li><p>options on the command line that can be used multiple times can accept
values here as comma-separated strings</p></li>
<li><p>options with a hyphen need to use an underscore instead. <code class="docutils literal notranslate"><span class="pre">--disk-size</span></code> for
example would be <code class="docutils literal notranslate"><span class="pre">disk_size</span></code> in the config file</p></li>
</ul>
</div>
<div class="section" id="ova-features">
<h3>OVA Features<a class="headerlink" href="#ova-features" title="Permalink to this headline"></a></h3>
<p>If you’re building OVAs, either for RHEVM or vSphere, you can specify OVA
options with a special section in the configuration file. It looks something
like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">ova</span><span class="o">-</span><span class="n">options</span><span class="p">]</span>
<span class="n">vsphere_product_version</span><span class="o">=</span><span class="mi">22</span>
<span class="n">rhevm_description</span><span class="o">=</span><span class="n">Fedora</span> <span class="n">Cloud</span> <span class="mi">22</span>
<span class="n">vsphere_product_vendor_name</span><span class="o">=</span><span class="n">Fedora</span> <span class="n">Project</span>
<span class="n">ovf_memory_mb</span><span class="o">=</span><span class="mi">6144</span>
<span class="n">rhevm_default_display_type</span><span class="o">=</span><span class="mi">1</span>
<span class="n">vsphere_product_name</span><span class="o">=</span><span class="n">Fedora</span> <span class="n">Cloud</span> <span class="mi">22</span>
<span class="n">ovf_cpu_count</span><span class="o">=</span><span class="mi">4</span>
<span class="n">rhevm_os_descriptor</span><span class="o">=</span><span class="n">Fedora</span><span class="o">-</span><span class="mi">22</span>
</pre></div>
</div>
<p>or this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">ova</span><span class="o">-</span><span class="n">options</span><span class="p">]</span>
<span class="n">vsphere_ova_format</span> <span class="o">=</span> <span class="n">vagrant</span><span class="o">-</span><span class="n">virtualbox</span>
<span class="n">rhevm_ova_format</span> <span class="o">=</span> <span class="n">vagrant</span><span class="o">-</span><span class="n">libvirt</span>
<span class="n">vagrant_sync_directory</span> <span class="o">=</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">vagrant</span><span class="o">/</span><span class="n">sync</span>
</pre></div>
</div>
<p>The second one is actually the secret sauce for generating an image for use in
Vagrant. At this time, you would need rename the image file extension from .ova
to .box, but otherwise this should work fine.</p>
</div>
<div class="section" id="kickstart-preparation">
<h3>Kickstart Preparation<a class="headerlink" href="#kickstart-preparation" title="Permalink to this headline"></a></h3>
<p>Kickstarts for the image-build command have some specific requirements which
are covered in this section.</p>
<div class="section" id="required-kickstart-arguments">
<h4>Required Kickstart Arguments<a class="headerlink" href="#required-kickstart-arguments" title="Permalink to this headline"></a></h4>
<p>Anaconda of course requires many commands to be defined in the kickstart file.
If you’re starting from scratch you should review the reference linked above,
or use an existing kickstart file in the spin-kickstarts git repo. It is
critically important that the installation be completely automated, if
Anaconda has to prompt for input for any reason, the build will fail because
you cannot send input to the guest. Some of the kickstart commands are optional
to Anaconda, but are required in Koji for your build to succeed. Here’s the
list and the reasons why.</p>
<dl class="simple">
<dt>zerombr</dt><dd><p>You must tell Anaconda to wipe out the MBR in the virtual block device, if
you don’t Anaconda will ask you.</p>
</dd>
<dt>clearpart –all –initlabel</dt><dd><p>Anaconda has to be told to wipe out all data on the virtual block device we
install on otherwise it will ask for confirmation to do so. Since it is
blank anyway this is harmless.</p>
</dd>
<dt>reboot</dt><dd><p>When the installation completes, the guest is rebooted. <a class="reference external" href="http://imgfac.org/">ImageFactory</a> is
specifically looking for this behavior to conclude the installation
completed. Anaconda’s default behavior is to wait for a key press to reboot
the system, but this is impossible from outside of Koji.</p>
</dd>
<dt>locking the root account</dt><dd><p>You have to lock the root account (rootpw –lock) or create a non-root user
(user), otherwise Anaconda will prompt for one.</p>
</dd>
<dt>Do not use the url command</dt><dd><p>The repo commands are overridden by Koji to point to internal Koji repos,
or what you specified on the command line with <code class="docutils literal notranslate"><span class="pre">--repo</span></code>, it does not
override the url command if you provided it. Anaconda has a behavior where
it will prefer packages from the repositories given with the url command
over those with the repo command, and this is generally not what you want.
If Koji sees an RPM was installed that was not built in the system, it will
fail the build.</p>
</dd>
</dl>
</div>
<div class="section" id="recommended-kickstart-arguments">
<h4>Recommended Kickstart Arguments<a class="headerlink" href="#recommended-kickstart-arguments" title="Permalink to this headline"></a></h4>
<p>Often you want a <code class="docutils literal notranslate"><span class="pre">%post</span></code> section in your kickstart to perform
post-installation configuration steps. Review that section of the reference
and note that you can specify <code class="docutils literal notranslate"><span class="pre">--log</span></code> and <code class="docutils literal notranslate"><span class="pre">--interpreter</span></code>. Both of these
are recommended (but not required) to assist with the development and debugging
process. Here are some other recommendations:</p>
<ul class="simple">
<li><p>You probably want the network to use dhcp, sshd to be started, and port 22
opened in the firewall to allow access as well.</p></li>
<li><p>If you’re building an image that will be shipped with a product, SELinux
should be enabled.</p></li>
<li><p>Images that will be used in cloud deployments like OpenStack or EC2 should
have <code class="docutils literal notranslate"><span class="pre">cloud-init</span></code> in the package list.</p></li>
<li><p>It is discouraged to have root passwords in plaintext in your kickstart file.</p></li>
<li><p>If your %post section is written in bash, consider setting -x.</p></li>
<li><p>For images that have multiple partitions, use the <code class="docutils literal notranslate"><span class="pre">--asprimary</span></code> option for
the part command that defines the root file system. This will ensure it is
the first partition on the image, which is a requirement in some cloud
environments like EC2.</p></li>
</ul>
</div>
</div>
<div class="section" id="id3">
<h3>Troubleshooting<a class="headerlink" href="#id3" title="Permalink to this headline"></a></h3>
<p>If your disk image build fails, follow the link in the command line output
that takes you to the task page in the Koji web UI. Click on the failed
createImage subtask in red. On that page review the screenshot.ppm file if it
was provided, or oz.log. Most failures are from Anaconda rejecting a malformed
kickstart file, which will be indicated in the screenshot. Your installation
must be completely automatic, there can be no interactivity at all, otherwise
Anaconda will sit there indefinitely until Koji (actually ImageFactory) kills
the task.</p>
<p>It is very easy to write a kickstart file with bugs or that results in a system
that does not boot. This section will present a series of questions to ask
yourself and examples to help diagnose where the problem lies. Once you know
that, it should be easier to understand what you can do to inspect further.</p>
<p>There are 4 steps in the process:</p>
<ol class="arabic simple">
<li><p>create a guest</p></li>
<li><p>perform an automated installation in the guest</p></li>
<li><p>boot the guest and extract the list of installed RPMs</p></li>
<li><p>upload and archive the disk image of the guest</p></li>
</ol>
<div class="section" id="is-it-a-problem-with-guest-creation">
<h4>Is it a problem with guest creation?<a class="headerlink" href="#is-it-a-problem-with-guest-creation" title="Permalink to this headline"></a></h4>
<p>There have been unusual cases where libvirt, ImageFactory, or Oz was
misconfigured and guests could not be started properly. A misconfiguration with
Puppet or whatever Fedora Infrastructure is up to can cause this. So far the
errors have been clear in the task output, look either in the results string
or oz.log. The bad news is that in this case you really can only inform Rel-Eng
about the issue and wait for a resolution. The good news is these cases are
very rare.</p>
</div>
<div class="section" id="did-the-installation-fail">
<h4>Did the installation fail?<a class="headerlink" href="#did-the-installation-fail" title="Permalink to this headline"></a></h4>
<p>The Anaconda installation can fail for many reasons: missing packages, network
problems, or syntax errors in %post. Tasks will also fail if Anaconda prompts
for input for any reason. If Koji detects a lack of disk activity in the guest
for more than 5 minutes, it will fail the build and tear down the guest.
Looking in oz.log may have the answer: dracut, anaconda, and yum logs are all
printed there.</p>
<p>These sorts of failures often have a screenshot taken and saved with the task
output called screenshot.ppm. Viewing this will usually tell you what Anaconda
is complaining about if the installer detected an issue or prompted for input.
The string in the results output that says “No disk activity in 300 seconds,
failing.” This almost always means Anaconda hit an issue and either gave up or
waited.</p>
<p>If Anaconda claims it is missing packages, confirm they exist in the repos you
are using with <code class="docutils literal notranslate"><span class="pre">--repo</span></code>, if you are using that option. If you are not,
confirm the builds you expect are in the tag inheritance for the target you are
running. This is a lot like checking whether an RPM will build against the
right libraries, except we’re building an image instead.</p>
<p>If you get the rare Anaconda dialog box that says something like “An unexpected
error occurred”, try using the <code class="docutils literal notranslate"><span class="pre">text</span></code> command in kickstart, which will have
Anaconda boot in text mode. Sometimes the Python traceback (or whatever the
error condition is) will be printed there. I have also seen cases where
text-mode yields a black screen, but booting in graphical mode (the default)
does produce a useful dialog box. Issues like this stem from syntax errors in
the kickstart file, or bugs in pykickstart itself. If you think it is a
pykickstart bug, then someone in Rel-Eng needs to update pykickstart on the
builders.</p>
</div>
<div class="section" id="did-the-guest-boot">
<h4>Did the guest boot?<a class="headerlink" href="#did-the-guest-boot" title="Permalink to this headline"></a></h4>
<p>Koji waits 5 minutes for a guest to boot in this step. It unfortunately does
not give a lot of insight to why a guest may not boot, so these are a tougher
class of issues to work through. You can usually answer this question by
looking in results string. If you see “Timed out waiting for guest to boot”,
then this is your problem. You can also confirm this in oz.log.</p>
<p>For now, the best way to investigate an issue like this is to drive a guest
installation locally using something like Gnome’s Virtual Machine Manager
(VMM). The steps to perform are:</p>
<ul class="simple">
<li><p>Select a Network Install</p></li>
<li><p>For the Operating System Install URL use the same one you gave to Koji. It
will be something like
<a class="reference external" href="https://alt.fedoraproject.org/pub/alt/releases/22/Cloud/x86_64/os/">https://alt.fedoraproject.org/pub/alt/releases/22/Cloud/x86_64/os/</a></p></li>
<li><p>Set the Kickstart URL to where your kickstart file is. You may need to make
it available over http.</p></li>
<li><p>Bump the memory to 2048M for good measure</p></li>
<li><p>Launch the guest and let it complete installation</p></li>
<li><p>Open a VNC session and watch what happens when the guest attempts to boot.</p></li>
</ul>
<p>If the console is not providing enough information, we have to get more
creative. Anaconda supports starting an SSH daemon while the installation is
happening with the sshpw command in kickstart. Set that and comment out the
reboot command. This will let the installation complete locally and wait for a
keystroke to reboot the guest. At this point you should be able to ssh in and
inspect the environment to figure out what is going on. You should also
consider making use of the <code class="docutils literal notranslate"><span class="pre">--log</span></code> option to %post so that output from the
script is saved somewhere.</p>
<p>Another option would be to scp logs and other files off of the guest as part of
the <code class="docutils literal notranslate"><span class="pre">%post</span></code> script.</p>
</div>
<div class="section" id="other-guest-misconfigurations">
<h4>Other Guest Misconfigurations<a class="headerlink" href="#other-guest-misconfigurations" title="Permalink to this headline"></a></h4>
<p>If the guest boots but you’re having problems accessing it I’d suggest
following same procedure as when the guest fails to boot. This could be a
result of firewall misconfigurations or SSH not being available for some
reason. Usually in this case the build is succeeding in Koji, but there’s
something still fundamentally broken in the image. If the issue is something
you can investigate while the guest is online (you can log in), then I’d
suggest importing it locally using the libvirt.xml and the disk image provided
in Koji’s task output.</p>
<p>You can also do investigative work in an offline mode by mounting the image
locally or using something like libguestfs to poke around without starting the
guest. The fast, dirty way to do it is by mounting it. This can often pollute
your guest environment. Here’s how to do it:</p>
<ul>
<li><p>Download the image from Koji</p></li>
<li><p>If the image format is not raw, you have to convert it first with qemu-img.
Something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ qemu-img convert -O raw &lt;image-file&gt; &lt;output-file&gt;&lt;/pre&gt;
</pre></div>
</div>
</li>
<li><p>Now mount it up using loopback devices. (as root) If your image has multiple
partitions in it, you may need to pass in a different mapped loopback device
like <code class="docutils literal notranslate"><span class="pre">loop0p2</span></code>. Whichever one you think is the root partition or has the
issue you’re trying to fix.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># kpartx -av &lt;raw-image&gt;</span>
<span class="c1"># mount -o loop /dev/mapper/loop0p1 /mnt/my_directory</span>
</pre></div>
</div>
</li>
</ul>
<p>Hopefully at this point you figure out the issue. To tear down the image you’ll
run commands as root like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># umount /mnt/my_directory</span>
<span class="c1"># dmsetup remove loop0p1</span>
<span class="c1"># losetup -d /dev/loop0</span>
</pre></div>
</div>
<p>Again, if you used different loopback devices, substitute those in to the
dmsetup and losetup commands.</p>
</div>
</div>
<div class="section" id="id4">
<h3>Build System Preparation<a class="headerlink" href="#id4" title="Permalink to this headline"></a></h3>
<p>Follow this guide if you’re a Koji admin and would like to enable image
building or want to set up some testing before enabling the integration.</p>
<p>When moving to ImageFactory to do image builds Koji lost the ability to easily
reproduce the build environment for images the way we do for RPMs using Mock.
This section will document how to set up an image builder for Koji. This is a
lengthy task, it will take first-timers about a week to have a useful instance,
and it is painful because it requires a bare metal system be provisioned since
<a class="reference external" href="http://imgfac.org/">ImageFactory</a> provisions VMs to build the image. There is a significant
performance penalty for using nested virtualization.</p>
<p>Follow the steps below to set up your builder.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You do not have to stand up a complete Koji instance to test the way Koji
builds images. However, if you want to test image builds with an accurate
representation of how Koji does it, or you want to test code changes
related to image builds in Koji, you should follow all the steps below.</p>
</div>
<div class="section" id="imagefactory-oz-preparation">
<h4>ImageFactory/Oz Preparation<a class="headerlink" href="#imagefactory-oz-preparation" title="Permalink to this headline"></a></h4>
<ol class="arabic">
<li><p>Provision a system with at least 4G of memory with the current release of
RHEL 6 or later. Sometimes builders lag behind a month or two before taking
in updates, but this will still get you pretty close to where you want to
be. For Fedora, use the latest release.</p></li>
<li><p>Install the following packages to the builder.
#.  oz
#.  imagefactory
#.  imagefactory-plugins-TinMan
#.  imagefactory-plugins-vSphere
#.  imagefactory-plugins-ovfcommon
#.  imagefactory-plugins-docker
#.  imagefactory-plugins
#.  imagefactory-plugins-OVA
#.  imagefactory-plugins-RHEVM
#.  python-psphere =&gt; 0.5
#.  VMDKStream =&gt; 0.2
#.  pykickstart</p></li>
<li><p>Edit <code class="docutils literal notranslate"><span class="pre">/etc/kojid/kojid.conf</span></code>, and set an second value, eg: 7200 for
<code class="docutils literal notranslate"><span class="pre">oz_install_timeout</span></code>. It’s a timeout waiting guest installing. Default
value is 0, that means oz will use its default value. Since <code class="docutils literal notranslate"><span class="pre">oz-0.16.0</span></code>,
it can be configured in <code class="docutils literal notranslate"><span class="pre">/etc/oz/oz.cfg</span></code> as <code class="docutils literal notranslate"><span class="pre">install</span></code> in <code class="docutils literal notranslate"><span class="pre">[timeouts]</span></code>
section.</p></li>
<li><p>Edit <code class="docutils literal notranslate"><span class="pre">/etc/oz/oz.cfg</span></code>, and set the memory value in the <code class="docutils literal notranslate"><span class="pre">[libvirt]</span></code>
section to at least 2048. Set <code class="docutils literal notranslate"><span class="pre">safe_generation</span></code> under <code class="docutils literal notranslate"><span class="pre">[icicle]</span></code> to yes.</p></li>
<li><p>Run: <code class="docutils literal notranslate"><span class="pre">mkdir</span> <span class="pre">-p</span> <span class="pre">~root/.psphere/templates</span></code>, and then copy the following
code into <code class="docutils literal notranslate"><span class="pre">~root/.psphere/config.yaml</span></code>. Do not worry about the server,
username, and password credentials; they are not used anywhere.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">general</span><span class="p">:</span>
  <span class="n">server</span><span class="p">:</span> <span class="mf">10.16.120.224</span>
  <span class="n">username</span><span class="p">:</span> <span class="n">Administrator</span>
  <span class="n">password</span><span class="p">:</span> <span class="n">whatever</span>
  <span class="n">template_dir</span><span class="p">:</span> <span class="o">~/.</span><span class="n">psphere</span><span class="o">/</span><span class="n">templates</span><span class="o">/</span>
<span class="n">logging</span><span class="p">:</span>
  <span class="n">destination</span><span class="p">:</span> <span class="o">~/.</span><span class="n">psphere</span><span class="o">/</span><span class="n">psphere</span><span class="o">.</span><span class="n">log</span>
  <span class="n">level</span><span class="p">:</span> <span class="n">DEBUG</span> <span class="c1"># DEBUG, INFO, etc</span>
</pre></div>
</div>
</li>
</ol>
<p>Start up the services and ImageFactory/Oz should be ready to go. You should
read more about <a class="reference external" href="https://github.com/clalancette/oz/wiki">how to use Oz</a> and <a class="reference external" href="http://imgfac.org/documentation/">how to use ImageFactory</a>. If you want
to try calling <a class="reference external" href="http://imgfac.org/">ImageFactory</a> as if from a Koji Builder (but not set up a
whole Koji instance), you can use the code below to emulate that. If you want
to test the Koji integration with a full Koji instance, proceed to the next
section instead.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/python -tt</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">from</span> <span class="nn">imgfac.BuildDispatcher</span> <span class="kn">import</span> <span class="n">BuildDispatcher</span>
<span class="kn">from</span> <span class="nn">imgfac.PluginManager</span> <span class="kn">import</span> <span class="n">PluginManager</span>
<span class="kn">from</span> <span class="nn">imgfac.ReservationManager</span> <span class="kn">import</span> <span class="n">ReservationManager</span>
<span class="n">plugin_mgr</span> <span class="o">=</span> <span class="n">PluginManager</span><span class="p">(</span><span class="s1">&#39;/etc/imagefactory/plugins.d&#39;</span><span class="p">)</span>
<span class="n">plugin_mgr</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">imgfac.ApplicationConfiguration</span> <span class="kn">import</span> <span class="n">ApplicationConfiguration</span>

<span class="c1"># logging</span>
<span class="n">handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
<span class="n">tlog</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
<span class="n">tlog</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="n">tlog</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>

<span class="c1"># configuration</span>
<span class="n">ks</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;oztest.ks&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">workdir</span> <span class="o">=</span> <span class="s1">&#39;/tmp/koji/test&#39;</span>
<span class="n">config</span> <span class="o">=</span>  <span class="p">{</span>
    <span class="c1">#Oz specific</span>
    <span class="s1">&#39;oz_data_dir&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;oz_data&#39;</span><span class="p">),</span>
    <span class="s1">&#39;oz_screenshot_dir&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;oz_screenshots&#39;</span><span class="p">),</span>
    <span class="c1">#IF specific</span>
    <span class="s1">&#39;imgdir&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;scratch_images&#39;</span><span class="p">),</span>
    <span class="s1">&#39;tmpdir&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;oz-tmp&#39;</span><span class="p">),</span>
    <span class="s1">&#39;verbose&#39;</span> <span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s1">&#39;timeout&#39;</span><span class="p">:</span> <span class="mi">3600</span><span class="p">,</span>
    <span class="s1">&#39;output&#39;</span><span class="p">:</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span>
    <span class="s1">&#39;raw&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s1">&#39;debug&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s1">&#39;image_manager&#39;</span><span class="p">:</span> <span class="s1">&#39;file&#39;</span><span class="p">,</span>
    <span class="s1">&#39;plugins&#39;</span><span class="p">:</span> <span class="s1">&#39;/etc/imagefactory/plugins.d&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tdl_require_root_pw&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s1">&#39;image_manager_args&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;storage_path&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">workdir</span><span class="p">,</span> <span class="s1">&#39;output_image&#39;</span><span class="p">)},</span>
<span class="p">}</span>
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">()</span> <span class="c1"># necessary to ensure a unique mac address</span>
<span class="n">rm</span> <span class="o">=</span> <span class="n">ReservationManager</span><span class="p">()</span>
<span class="n">rm</span><span class="o">.</span><span class="n">_listen_port</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">rm</span><span class="o">.</span><span class="n">MIN_PORT</span><span class="p">,</span> <span class="n">rm</span><span class="o">.</span><span class="n">MAX_PORT</span><span class="p">)</span>
<span class="n">ApplicationConfiguration</span><span class="p">(</span><span class="n">configuration</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;install_script&#39;</span><span class="p">:</span> <span class="n">ks</span><span class="p">}</span>
<span class="n">template</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;template&gt;</span>
<span class="s2">    &lt;name&gt;test-appliance&lt;/name&gt;</span>
<span class="s2">        &lt;os&gt;</span>
<span class="s2">            &lt;name&gt;Fedora&lt;/name&gt;</span>
<span class="s2">            &lt;version&gt;22&lt;/version&gt;</span>
<span class="s2">            &lt;arch&gt;x86_64&lt;/arch&gt;</span>
<span class="s2">            &lt;install type=&#39;url&#39;&gt;</span>
<span class="s2">                &lt;url&gt;https://alt.fedoraproject.org/pub/alt/releases/22/Cloud/x86_64/os/&lt;/url&gt;</span>
<span class="s2">            &lt;/install&gt;</span>
<span class="s2">            &lt;icicle&gt;</span>
<span class="s2">                &lt;extra_command&gt;rpm -qa --qf &#39;%</span><span class="si">{NAME}</span><span class="s2">,%</span><span class="si">{VERSION}</span><span class="s2">,%</span><span class="si">{RELEASE}</span><span class="s2">,%</span><span class="si">{ARCH}</span><span class="s2">,%</span><span class="si">{EPOCH}</span><span class="s2">,%</span><span class="si">{SIZE}</span><span class="s2">,%</span><span class="si">{SIGMD5}</span><span class="s2">,%</span><span class="si">{BUILDTIME}</span><span class="se">\n</span><span class="s2">&#39;&lt;/extra_command&gt;</span>
<span class="s2">            &lt;/icicle&gt;</span>
<span class="s2">        &lt;/os&gt;</span>
<span class="s2">    &lt;description&gt;test-appliance OS&lt;/description&gt;</span>
<span class="s2">    &lt;disk&gt;</span>
<span class="s2">        &lt;size&gt;16G&lt;/size&gt;</span>
<span class="s2">    &lt;/disk&gt;</span>
<span class="s2">&lt;/template&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">bd</span> <span class="o">=</span> <span class="n">BuildDispatcher</span><span class="p">()</span>

<span class="c1"># build the image</span>
<span class="n">base</span> <span class="o">=</span> <span class="n">bd</span><span class="o">.</span><span class="n">builder_for_base_image</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
<span class="n">base</span><span class="o">.</span><span class="n">base_thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
<span class="n">tlog</span><span class="o">.</span><span class="n">removeHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
</pre></div>
</div>
<p>This script is run as root with no arguments. It uses <code class="docutils literal notranslate"><span class="pre">oztest.ks</span></code> in your
local directory as the kickstart you want to try to use. The URL in the XML
template is where the RPM packages will be installed from, and what the guest
will be booted with.</p>
</div>
<div class="section" id="koji-preparation">
<h4>Koji Preparation<a class="headerlink" href="#koji-preparation" title="Permalink to this headline"></a></h4>
<ol class="arabic">
<li><p><a class="reference internal" href="server_howto.html"><span class="doc">Install Koji</span></a> if you need it. This will easily be the
most time-consuming part of the process; my first time took 3 days to get
it working properly. Follow the guide closely, and go with the SSL
authentication method. SSL is a lot easier to set up locally. You will need
to install every Koji component (except koji-vmd) on the same system.
Proceed to the next step after you’ve had a successful Kojira repository
generated.</p></li>
<li><p>At this point, you have a system that should be ready to build images. We
just have to do some Koji configuration so that your instance is pulling
content from Koji. Replace the base tag names with whatever fits your
conventions.</p>
<blockquote>
<div><ol class="arabic">
<li><p>Add tags, tag inheritance, new pkg (with pkg owner), new external repo, and regen the repo</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">koji</span> <span class="n">add</span><span class="o">-</span><span class="n">tag</span> <span class="n">fedora22</span>
<span class="n">koji</span> <span class="n">add</span><span class="o">-</span><span class="n">tag</span> <span class="n">jay</span><span class="o">-</span><span class="n">fedora22</span>
<span class="n">koji</span> <span class="n">add</span><span class="o">-</span><span class="n">tag</span> <span class="n">jay</span><span class="o">-</span><span class="n">fedora22</span><span class="o">-</span><span class="n">override</span> <span class="o">--</span><span class="n">parent</span> <span class="n">jay</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">fedora22</span>
<span class="n">koji</span> <span class="n">add</span><span class="o">-</span><span class="n">tag</span> <span class="n">jay</span><span class="o">-</span><span class="n">fedora22</span><span class="o">-</span><span class="n">build</span> <span class="o">--</span><span class="n">arches</span> <span class="n">x86_64</span> <span class="o">--</span><span class="n">parent</span> <span class="n">jay</span><span class="o">-</span><span class="n">fedora22</span><span class="o">-</span><span class="n">override</span>
<span class="n">koji</span> <span class="n">add</span><span class="o">-</span><span class="n">tag</span> <span class="n">jay</span><span class="o">-</span><span class="n">fedora22</span><span class="o">-</span><span class="n">candidate</span> <span class="o">--</span><span class="n">parent</span> <span class="n">jay</span><span class="o">-</span><span class="n">fedora22</span>
<span class="n">koji</span> <span class="n">add</span><span class="o">-</span><span class="n">tag</span><span class="o">-</span><span class="n">inheritance</span> <span class="o">--</span><span class="n">priority</span> <span class="mi">40</span> <span class="n">jay</span><span class="o">-</span><span class="n">fedora22</span><span class="o">-</span><span class="n">build</span> <span class="n">fedora22</span>
<span class="n">koji</span> <span class="n">add</span><span class="o">-</span><span class="n">pkg</span> <span class="o">--</span><span class="n">owner</span> <span class="n">kojiadmin</span> <span class="n">jay</span><span class="o">-</span><span class="n">fedora22</span> <span class="n">fedora</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">ec2</span> <span class="n">fedora</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">kvm</span>
<span class="n">koji</span> <span class="n">add</span><span class="o">-</span><span class="n">external</span><span class="o">-</span><span class="n">repo</span> <span class="o">-</span><span class="n">t</span> <span class="n">fedora</span><span class="p">::</span><span class="mi">20</span> <span class="n">fedora22</span> <span class="s1">&#39;https://alt.fedoraproject.org/pub/alt/releases/22/Cloud/$arch/os/&#39;</span>
<span class="n">koji</span> <span class="n">add</span><span class="o">-</span><span class="n">target</span> <span class="n">jay</span><span class="o">-</span><span class="n">fedora22</span><span class="o">-</span><span class="n">candidate</span> <span class="n">jay</span><span class="o">-</span><span class="n">fedora22</span><span class="o">-</span><span class="n">build</span>
<span class="n">koji</span> <span class="n">regen</span><span class="o">-</span><span class="n">repo</span> <span class="n">jay</span><span class="o">-</span><span class="n">fedora22</span><span class="o">-</span><span class="n">build</span>
</pre></div>
</div>
</li>
<li><p>Grab a kickstart file from an image task in Koji that relates to what you want to test.</p></li>
<li><p>Finally, kick off a build!</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">koji</span> <span class="n">image</span><span class="o">-</span><span class="n">build</span> <span class="n">fedora</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">ec2</span> <span class="mi">22</span> <span class="o">--</span><span class="n">distro</span> <span class="n">Fedora</span><span class="o">-</span><span class="mi">22</span> <span class="n">jay</span><span class="o">-</span><span class="n">fedora22</span><span class="o">-</span><span class="n">candidate</span> <span class="o">--</span><span class="n">kickstart</span> <span class="n">fedora</span><span class="o">-</span><span class="n">server</span><span class="o">-</span><span class="n">starter</span><span class="o">-</span><span class="n">ec2</span><span class="o">.</span><span class="n">ks</span> <span class="s1">&#39;https://alt.fedoraproject.org/pub/alt/releases/22/Cloud/$arch/os/&#39;</span>
</pre></div>
</div>
</li>
</ol>
</div></blockquote>
</li>
</ol>
</div>
</div>
</div>
<div class="section" id="building-appliances">
<h2>Building Appliances<a class="headerlink" href="#building-appliances" title="Permalink to this headline"></a></h2>
<p>This section is here for the sake of legacy. Unless you are trying to build
ARM images, you should use the image-build command described in the previous
section.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The spin-appliance command, described herein, is deprecated.</p>
</div>
<div class="section" id="id5">
<h3>Getting Started<a class="headerlink" href="#id5" title="Permalink to this headline"></a></h3>
<p>Here’s what you need before proceeding:</p>
<ul class="simple">
<li><p>a name for your Appliance, and a version number</p></li>
<li><p>a Koji build target</p></li>
<li><p>what architectures you want</p></li>
<li><p>a flattened kickstart file</p></li>
<li><p>you may also need yum repositories generated by release engineering if you
require signed packages be installed into the appliance</p></li>
<li><p>the appliance permission in Koji</p></li>
</ul>
<p>The Koji command that creates an Appliance is called <code class="docutils literal notranslate"><span class="pre">spin-appliance</span></code>. It
calls out to appliance-creator in a mock chroot to construct the Appliance.
To run an Appliance build, use the spin-appliance command like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ koji spin-appliance --release 4 fedora-workstation 23 f23-build fedora-workstation.ks
</pre></div>
</div>
<p>In this example an Appliance will be created with the N-V-R of
<code class="docutils literal notranslate"><span class="pre">fedora-workstation-23-4</span></code>. If <code class="docutils literal notranslate"><span class="pre">--release</span></code> was not included an incrementing
value would be computed by Koji instead. spin-appliance takes a minimum of 5
arguments:</p>
<dl class="simple">
<dt>Name</dt><dd><p>the name of the image, without versioning information. Examples could be
<code class="docutils literal notranslate"><span class="pre">fedora</span></code> or <code class="docutils literal notranslate"><span class="pre">fedora-workstation</span></code>.</p>
</dd>
<dt>Version</dt><dd><p>an arbitrary version string. For Fedora images, this usually matches the
release version, such as 21, 22, or 23.</p>
</dd>
<dt>Build Target</dt><dd><p>just like RPM builds Koji must be told which target to use. This controls
what tag the image will be tagged into, and what packages are available to
install into the image.</p>
</dd>
<dt>Architecture</dt><dd><p>only arm, x86_64, or i386 are supported</p>
</dd>
<dt>Kickstart File</dt><dd><p>this is a recipe file that performs drives the construction of the image.</p>
</dd>
</dl>
<p>Use <code class="docutils literal notranslate"><span class="pre">--help</span></code> to discover more options to spin-appliance. You can override the
Release field with <code class="docutils literal notranslate"><span class="pre">--release</span></code>, or <code class="docutils literal notranslate"><span class="pre">--repo</span></code> to override what yum repo is
used to provide packages to install to the image. Note that regardless of what
repo you use, it must contain RPMs built by Koji, otherwise you will get an
error. (unless you are building a scratch image)</p>
</div>
<div class="section" id="id6">
<h3>Mechanics<a class="headerlink" href="#id6" title="Permalink to this headline"></a></h3>
<p>The way Appliances are created in Koji is the same as <a class="reference internal" href="#building-livemedia"><span class="std std-ref">Building LiveMedias</span></a>.</p>
</div>
<div class="section" id="caveats-for-appliances">
<h3>Caveats for Appliances<a class="headerlink" href="#caveats-for-appliances" title="Permalink to this headline"></a></h3>
<p>Caveats for using <code class="docutils literal notranslate"><span class="pre">spin-appliance</span></code> are the same as using <code class="docutils literal notranslate"><span class="pre">spin-livemedia</span></code> to
<a class="reference internal" href="#caveats-for-livemedias"><span class="std std-ref">Caveats for LiveMedias</span></a>.</p>
</div>
<div class="section" id="id7">
<h3>Troubleshooting<a class="headerlink" href="#id7" title="Permalink to this headline"></a></h3>
<p>If your build fails, you will be notified on the command line. In the output
will be a URL to the Koji UI, visit that and click on the red subtask link.
From that page review <code class="docutils literal notranslate"><span class="pre">root.log</span></code> and <code class="docutils literal notranslate"><span class="pre">appliance.log</span></code> for errors. Often
errors are caused by packages being missing, or malformed kickstart files. The
log files are at the bottom of the page. If you’re stuck, contact Release
Engineering.</p>
</div>
<div class="section" id="id8">
<h3>Build System Preparation<a class="headerlink" href="#id8" title="Permalink to this headline"></a></h3>
<p>This section assumes you have know-how required to install and configure a new
instance of Koji, and that you have already done so. You can learn how to do so
<a class="reference internal" href="server_howto.html"><span class="doc">here</span></a> if you need to. Please ensure you are using the
latest version of the software and that your database schema is updated as
well. You should also have some familiarity with how <a class="reference external" href="https://fedoraproject.org/wiki/Features/ApplianceTools">appliance-creator</a>
works. This section only covers preparation for Appliance builds.</p>
<p>Follow this procedure step by step to get things prepared they way they need
to be.</p>
<ol class="arabic">
<li><dl>
<dt>Add a builder to the appliance channel</dt><dd><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">koji</span> <span class="n">add</span><span class="o">-</span><span class="n">host</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">channel</span> <span class="o">&lt;</span><span class="n">your</span><span class="o">-</span><span class="n">host</span><span class="o">&gt;</span> <span class="n">appliance</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><p>Grant the permission to build an appliance to a user. This step is optional
since admins have all permissions.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">koji</span> <span class="n">grant</span><span class="o">-</span><span class="n">permission</span> <span class="n">appliance</span> <span class="o">&lt;</span><span class="n">user</span><span class="o">&gt;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>You will need a tag and target to build the images from. The yum repo
generated for the build tag of the target is what Koji will use to populate
the Appliances with by default. (the alternative is to use the <code class="docutils literal notranslate"><span class="pre">--repo</span></code>
option, more on that later)</p></li>
<li><p>Add the appliance-build group</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>koji add-group &lt;build-tag&gt; appliance-build``
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Add packages to the appliance-build group. These package lists vary has
packages and dependencies change. As of October, 2015 for Fedora 24 the
needed packages for appliances:</p>
<blockquote>
<div><ul class="simple">
<li><p>appliance-tools, bash, coreutils, grub, parted, perl, policycoreutils,
selinux-policy, shadow-utils, sssd-client</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">koji</span> <span class="n">add</span><span class="o">-</span><span class="n">group</span><span class="o">-</span><span class="n">pkg</span> <span class="o">&lt;</span><span class="n">build</span><span class="o">-</span><span class="n">tag</span><span class="o">&gt;</span> <span class="n">appliance</span><span class="o">-</span><span class="n">build</span> <span class="o">&lt;</span><span class="n">pkg</span><span class="o">&gt;</span> <span class="o">...</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="database_howto.html" class="btn btn-neutral float-left" title="Database Performance Howto" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="plugins.html" class="btn btn-neutral float-right" title="Plugins" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, Mike McLean, Mike B, Dennis Gilmore, Mathieu Bridon, Ian McLeod, Ralph Bean, Adam Miller.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>