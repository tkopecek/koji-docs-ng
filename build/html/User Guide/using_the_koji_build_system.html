<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Using the koji build system &mdash; Koji alpha documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Developer Guide" href="../Developer%20Guide/index.html" />
    <link rel="prev" title="User Guide" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Koji
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Operations%20Guide/index.html">Operations Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Administration%20Guide/index.html">Administration Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Guide</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Using the koji build system</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#using-koji-in-fedora">Using Koji in Fedora</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#installing-koji">Installing Koji</a></li>
<li class="toctree-l4"><a class="reference internal" href="#the-web-interface">The web interface</a></li>
<li class="toctree-l4"><a class="reference internal" href="#building-with-fedpkg-targets">Building with fedpkg targets</a></li>
<li class="toctree-l4"><a class="reference internal" href="#scratch-builds">Scratch Builds</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build-failures">Build Failures</a></li>
<li class="toctree-l4"><a class="reference internal" href="#advanced-use-of-koji">Advanced use of Koji</a></li>
<li class="toctree-l4"><a class="reference internal" href="#koji-tags-and-packages-organization">Koji tags and packages organization</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#koji-xmlrpc-api">Koji XMLRPC API</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Developer%20Guide/index.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../HOWTO.html">Koji HOWTO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc.html">Koji Miscellaneous Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../runs_here.html">Runs Here</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Koji</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">User Guide</a> &raquo;</li>
      <li>Using the koji build system</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/User Guide/using_the_koji_build_system.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="using-the-koji-build-system">
<h1>Using the koji build system<a class="headerlink" href="#using-the-koji-build-system" title="Permalink to this headline"></a></h1>
<div class="section" id="using-koji-in-fedora">
<h2>Using Koji in Fedora<a class="headerlink" href="#using-koji-in-fedora" title="Permalink to this headline"></a></h2>
<p>The <a class="reference external" href="Koji">Koji Build System</a> is Fedora’s RPM buildsystem. Packagers
use the koji client to request package builds and get information about
the buildsystem. Koji runs on top of Mock to build RPM packages for
specific architectures and ensure that they build correctly.</p>
<div class="section" id="installing-koji">
<h3>Installing Koji<a class="headerlink" href="#installing-koji" title="Permalink to this headline"></a></h3>
<div class="section" id="installing-the-koji-cli">
<h4>Installing the Koji CLI<a class="headerlink" href="#installing-the-koji-cli" title="Permalink to this headline"></a></h4>
<p>Everything you need to use Koji (and be a Fedora contributor) can be
installed in a single step:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dnf</span> <span class="n">install</span> <span class="n">fedora</span><span class="o">-</span><span class="n">packager</span>
</pre></div>
</div>
<p>fedora-packager provides useful scripts to help maintain and setup your
koji environment. Additionally, it includes dependencies on the Koji
CLI, so it will be installed when you install <code class="docutils literal notranslate"><span class="pre">fedora-packager</span></code>. The
command is called <code class="docutils literal notranslate"><span class="pre">koji</span></code> and is included in the main koji package. By
default the koji tool authenticates to the central server using
Kerberos. However SSL and username/password authentications are
available. You will need to have a valid authentication token to use
many features. However, many of the read-only commands will work without
authentication.</p>
<p>If you run into any problems with Fedora’s instance of koji, <a class="reference external" href="https://fedoraproject.org/wiki/Join_the_package_collection_maintainers#Install_the_developer_client_tools">here</a>
is actual documentation for installing and using developer client tools.</p>
<p>Alternatively, koji CLI is now also available via:</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="https://pagure.io/koji/releases">Project releases tarballs</a>
Preferred way is to use your distribution’s mechanism instead, as it
will also contain appropriate configuration files.</p></li>
<li><p><a class="reference external" href="https://pypi.python.org/pypi/koji">PyPi</a> There is only client/API
part and it is mostly usable for people who wants some more advanced
client-side scripting in virtualenv’s, so API-only access is not
sufficient for them or who can profit from some utilities in e.g. basic
<code class="docutils literal notranslate"><span class="pre">koji</span></code> library.</p></li>
<li><p>Actual development version via Pagure’s git: <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span>
<span class="pre">https://pagure.io/koji.git</span></code></p></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="koji-config">
<h4>Koji Config<a class="headerlink" href="#koji-config" title="Permalink to this headline"></a></h4>
<p>The global local client configuration file for koji is
<code class="docutils literal notranslate"><span class="pre">/etc/koji.conf</span></code>. You should not need to change this from the defaults
for building Fedora packages.These will allow you to use the primary
build system as well as secondary arch build systems.</p>
</div>
</div>
<div class="section" id="the-web-interface">
<h3>The web interface<a class="headerlink" href="#the-web-interface" title="Permalink to this headline"></a></h3>
<p>The primary interface for viewing Koji data is a web application. It is
available at <a class="reference external" href="https://koji.fedoraproject.org/koji/">https://koji.fedoraproject.org/koji/</a> . Most of the interface
is read-only, but with sufficient privileges, you can log in and perform
some additional actions. For example:</p>
<ul class="simple">
<li><p>Cancel a build</p></li>
<li><p>Resubmit a failed task</p></li>
<li><p>Setup a notification</p></li>
</ul>
<p>Those with admin privileges will find additional actions, such as:</p>
<ul class="simple">
<li><p>Create/Edit/Delete a tag</p></li>
<li><p>Create/Edit/Delete a target</p></li>
<li><p>Enable/Disable a build host</p></li>
</ul>
<p>The web site utilizes SSL authentication. In order to log in you will
need a valid SSL certificate and your web browser will need to be
configured to trust the SSL cert. Instructions on how to do this are
printed when running <code class="docutils literal notranslate"><span class="pre">fedora-packager-setup</span> <span class="pre">--with-browser-cert</span></code>.</p>
<div class="section" id="installing-ssl-certificates-in-firefox">
<h4>Installing SSL Certificates in Firefox<a class="headerlink" href="#installing-ssl-certificates-in-firefox" title="Permalink to this headline"></a></h4>
<p>Once you have created your FAS account, generated your certificate in
the form posted in the link above and ran
<code class="docutils literal notranslate"><span class="pre">fedora-packager-setup</span> <span class="pre">--with-browser-cert</span></code>, you will need to import
it into your web browser. You can do this in Firefox by doing the
following:</p>
<ol class="arabic simple">
<li><p>Launch Firefox and click on the <strong>Edit</strong> menu from the toolbar</p></li>
<li><p>Select <strong>Preferences</strong> in the sub-menu which appears.</p></li>
</ol>
<p>3. This should open the <strong>Preferences</strong> window where you can switch to
the <strong>Advanced</strong> section</p>
<ol class="arabic simple" start="4">
<li><p>In the <strong>Advanced</strong> section switch to the <strong>Encryption</strong> tab</p></li>
</ol>
<p>5. Click on the <strong>View Certificates</strong> button and the Certificates window
will appear</p>
<p>6. Switch to the <strong>Your Certificates</strong> tab and click on the <strong>Import</strong>
button</p>
<p>7. Point to where your Fedora Certificate is located and click <strong>Open</strong>
(fedora-packager-setup will have told you where it was saved and will
have asked you to set a password for the cert)</p>
<p>You should now be able to see your Fedora Certificate listed under
<strong>Your Certificates</strong> and you should be able to authenticate with the
koji web interface.</p>
</div>
<div class="section" id="installing-ssl-certificates-in-chromium">
<h4>Installing SSL Certificates in Chromium<a class="headerlink" href="#installing-ssl-certificates-in-chromium" title="Permalink to this headline"></a></h4>
<p>Chromium uses the NSS Shared DB, you will need the nss-tools package
installed.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>pk12util -d sql:$HOME/.pki/nssdb -i fedora-browser-cert.p12
</pre></div>
</div>
</div>
<div class="section" id="notifications">
<h4>Notifications<a class="headerlink" href="#notifications" title="Permalink to this headline"></a></h4>
<p>Koji supports a limited number of email notifications:</p>
<blockquote>
<div><ul class="simple">
<li><p>build notifications: when builds complete or fail</p></li>
<li><p>tag notifications: when builds are tagged or untagged</p></li>
</ul>
</div></blockquote>
<p>These mails are sent to:</p>
<blockquote>
<div><ul class="simple">
<li><p>the owner of the build in question</p></li>
<li><p>(for tag notifications) the owner of the package for the tag</p></li>
<li><p>any user who as subscribed to notifications for that package or tag</p></li>
</ul>
</div></blockquote>
<p>Users can manage their notification subscriptions in the web interface.
To do so, they need to be logged in. The main page (Summary) will list
their subscriptions at the bottom. Each entry includes an “edit” and
“delete” link. Below that table is an “Add a notification” link for adding
new notifications.</p>
<p>Starting in Koji version 1.16.0, users can also manage these subscriptions
on the command line. The relevant commands are:</p>
<blockquote>
<div><ul class="simple">
<li><p>add-notification</p></li>
<li><p>edit-notification</p></li>
<li><p>list-notifications</p></li>
<li><p>remove-notification</p></li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="building-with-fedpkg-targets">
<h3>Building with fedpkg targets<a class="headerlink" href="#building-with-fedpkg-targets" title="Permalink to this headline"></a></h3>
<p>Every push is automatically tagged via git. All you have done to build
the package is to run,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fedpkg</span> <span class="n">build</span>
</pre></div>
</div>
<p>This will trigger a build request for the branch. Easy!</p>
<p>It is also possible to target a specific koji tag as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fedpkg</span> <span class="n">build</span> <span class="o">--</span><span class="n">target</span> <span class="n">TARGET</span>
</pre></div>
</div>
<p>for example, if building on rawhide against a special tag created by
rel-eng for updating API for many packages, e.g. <code class="docutils literal notranslate"><span class="pre">dist-f14-python</span></code> you
would use the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fedpkg</span> <span class="n">build</span> <span class="o">--</span><span class="n">target</span> <span class="s1">&#39;dist-f14-python&#39;</span>
</pre></div>
</div>
<div class="section" id="chained-builds">
<h4>Chained builds<a class="headerlink" href="#chained-builds" title="Permalink to this headline"></a></h4>
<p>Sometimes you want to make sure than one build succeeded before
launching the next one, for example when you want to rebuild a package
against a just rebuilt dependency. In that case you can use a chain
build with:</p>
<p><code class="docutils literal notranslate"><span class="pre">fedpkg chain-build libwidget libgizmo</span></code></p>
<p>The current package is added to the end of the CHAIN list. Colons (:)
can be used in the CHAIN parameter to define groups of packages.
Packages in any single group will be built in parallel and all packages
in a group must build successfully and populate the repository before
the next group will begin building. For example:</p>
<p><code class="docutils literal notranslate"><span class="pre">fedpkg chain-build libwidget libaselib : libgizmo :</span></code></p>
<p>will cause libwidget and libaselib to be built in parallel, followed by
libgizmo and then the correct directory package. If no groups are
defined, packages will be built sequentially.</p>
<p>If a build fail, following builds are cancelled but the builds that
already succeeded are pushed to the repository.</p>
</div>
</div>
<div class="section" id="scratch-builds">
<h3>Scratch Builds<a class="headerlink" href="#scratch-builds" title="Permalink to this headline"></a></h3>
<p>Sometimes it is useful to be able to build a package against the
buildroot but without actually including it in the release. This is
called a scratch build. The following section covers using koji directly
as well as the fedpkg tool to do scratch builds. To create a scratch
build from changes you haven’t committed, do the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rpmbuild</span> <span class="o">-</span><span class="n">bs</span> <span class="n">foo</span><span class="o">.</span><span class="n">spec</span>
<span class="n">koji</span> <span class="n">build</span> <span class="o">--</span><span class="n">scratch</span> <span class="n">rawhide</span> <span class="n">foo</span><span class="o">.</span><span class="n">srpm</span>
</pre></div>
</div>
<p>From the latest git commit:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">koji</span> <span class="n">build</span> <span class="o">--</span><span class="n">scratch</span> <span class="n">rawhide</span> <span class="s1">&#39;git url&#39;</span>
</pre></div>
</div>
<p>Warning: Scratch builds will <em>not</em> work correctly if your .spec file
does something different depending on the value of %fedora, %fc9, and so
on. Macro values like these are set by the <em>builder</em>, not by koji, so
the value of %fedora will be for whatever created the source RPM, and
<em>not</em> what it’s being built on. Non-scratch builds get around this by
first re-building the source RPM.</p>
<p>If you have committed the changes to git and you are in the current
branch, you can do a scratch build with fedpkg tool which wraps the koji
command line tool with the appropriate options:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fedpkg</span> <span class="n">scratch</span><span class="o">-</span><span class="n">build</span>
</pre></div>
</div>
<p>if you want to do a scratch build for a specific architecture, you can
type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   <span class="n">fedpkg</span> <span class="n">scratch</span><span class="o">-</span><span class="n">build</span><span class="o">-&lt;</span><span class="n">archs</span><span class="o">&gt;</span>

<span class="n">can</span> <span class="n">be</span> <span class="n">a</span> <span class="n">comma</span> <span class="n">separated</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">several</span> <span class="n">architectures</span><span class="o">.</span>
</pre></div>
</div>
<p>finally is possible to combine the scratch-build command with a specific
koji tag in the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fedpkg</span> <span class="n">scratch</span><span class="o">-</span><span class="n">build</span> <span class="o">--</span><span class="n">target</span> <span class="n">TARGET</span>
</pre></div>
</div>
<p>fedpkg scratch-build –help or koji build –help for more information.</p>
</div>
<div class="section" id="build-failures">
<h3>Build Failures<a class="headerlink" href="#build-failures" title="Permalink to this headline"></a></h3>
<p>If your package fails to build, you will see something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">420066</span> <span class="n">buildArch</span> <span class="n">kernel</span><span class="o">-</span><span class="mf">2.6.18</span><span class="o">-</span><span class="mf">1.2739.10.9</span><span class="o">.</span><span class="n">el5</span><span class="o">.</span><span class="n">jjf</span><span class="mf">.215394.2</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">rpm</span><span class="p">,</span>
<span class="n">ia64</span><span class="p">):</span> <span class="nb">open</span> <span class="p">(</span><span class="n">build</span><span class="o">-</span><span class="mf">1.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FAILED</span><span class="p">:</span> <span class="n">BuildrootError</span><span class="p">:</span>
<span class="n">error</span> <span class="n">building</span> <span class="n">package</span> <span class="p">(</span><span class="n">arch</span> <span class="n">ia64</span><span class="p">),</span> <span class="n">mock</span> <span class="n">exited</span> <span class="k">with</span> <span class="n">status</span> <span class="mi">10</span>
</pre></div>
</div>
<p>You can figure out why the build failed by looking at the log files. If
there is a build.log, start there. Otherwise, look at init.log.</p>
<p>Logs can be found via the web interface in the Task pages for the failed
task. Alternatively the koji client can be used to view the logs via the
<code class="docutils literal notranslate"><span class="pre">watch-logs</span></code> command. See the help output for more details.</p>
</div>
<div class="section" id="advanced-use-of-koji">
<h3>Advanced use of Koji<a class="headerlink" href="#advanced-use-of-koji" title="Permalink to this headline"></a></h3>
<p>We’ve tried to make Koji self-documenting wherever possible. The command
line tool will print a list of valid commands and each command supports
–help. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ koji help

Koji commands are:
build                Build a package from source
cancel-task          Cancel a task
help                 List available commands
latest-build         Print the latest builds for a tag
[...]
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ koji build --help

usage: koji build [options]  tag URL
(Specify the --help global option for a list of other help options)

options:
-h, --help            show this help message and exit
--skip-tag            Do not attempt to tag package
--scratch             Perform a scratch build
--nowait              Don&#39;t wait on build
[...]
</pre></div>
</div>
<div class="section" id="using-koji-to-generate-a-mock-config-to-replicate-a-buildroot">
<h4>Using koji to generate a mock config to replicate a buildroot<a class="headerlink" href="#using-koji-to-generate-a-mock-config-to-replicate-a-buildroot" title="Permalink to this headline"></a></h4>
<p>koji can be used to replicate a build root for local debugging</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">koji</span> <span class="n">mock</span><span class="o">-</span><span class="n">config</span> <span class="o">--</span><span class="n">help</span>
<span class="n">Usage</span><span class="p">:</span> <span class="n">koji</span> <span class="n">mock</span><span class="o">-</span><span class="n">config</span> <span class="p">[</span><span class="n">options</span><span class="p">]</span> <span class="n">name</span>
<span class="p">(</span><span class="n">Specify</span> <span class="n">the</span> <span class="o">--</span><span class="n">help</span> <span class="k">global</span> <span class="n">option</span> <span class="k">for</span> <span class="n">a</span> <span class="nb">list</span> <span class="n">of</span> <span class="n">other</span> <span class="n">help</span> <span class="n">options</span><span class="p">)</span>

<span class="n">Options</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
  <span class="o">--</span><span class="n">arch</span><span class="o">=</span><span class="n">ARCH</span>           <span class="n">Specify</span> <span class="n">the</span> <span class="n">arch</span>
  <span class="o">--</span><span class="n">tag</span><span class="o">=</span><span class="n">TAG</span>             <span class="n">Create</span> <span class="n">a</span> <span class="n">mock</span> <span class="n">config</span> <span class="k">for</span> <span class="n">a</span> <span class="n">tag</span>
  <span class="o">--</span><span class="n">task</span><span class="o">=</span><span class="n">TASK</span>           <span class="n">Duplicate</span> <span class="n">the</span> <span class="n">mock</span> <span class="n">config</span> <span class="n">of</span> <span class="n">a</span> <span class="n">previous</span> <span class="n">task</span>
  <span class="o">--</span><span class="n">buildroot</span><span class="o">=</span><span class="n">BUILDROOT</span>
                        <span class="n">Duplicate</span> <span class="n">the</span> <span class="n">mock</span> <span class="n">config</span> <span class="k">for</span> <span class="n">the</span> <span class="n">specified</span> <span class="n">buildroot</span>
                        <span class="nb">id</span>
  <span class="o">--</span><span class="n">mockdir</span><span class="o">=</span><span class="n">DIR</span>         <span class="n">Specify</span> <span class="n">mockdir</span>
  <span class="o">--</span><span class="n">topdir</span><span class="o">=</span><span class="n">DIR</span>          <span class="n">Specify</span> <span class="n">topdir</span>
  <span class="o">--</span><span class="n">topurl</span><span class="o">=</span><span class="n">URL</span>          <span class="n">url</span> <span class="n">under</span> <span class="n">which</span> <span class="n">Koji</span> <span class="n">files</span> <span class="n">are</span> <span class="n">accessible</span>
  <span class="o">--</span><span class="n">distribution</span><span class="o">=</span><span class="n">DISTRIBUTION</span>
                        <span class="n">Change</span> <span class="n">the</span> <span class="n">distribution</span> <span class="n">macro</span>
  <span class="o">-</span><span class="n">o</span> <span class="n">FILE</span>               <span class="n">Output</span> <span class="n">to</span> <span class="n">a</span> <span class="n">file</span>
</pre></div>
</div>
<p>for example to get the latest buildroot for dist-f12-build run</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">koji</span> <span class="n">mock</span><span class="o">-</span><span class="n">config</span> <span class="o">--</span><span class="n">tag</span> <span class="n">dist</span><span class="o">-</span><span class="n">f12</span><span class="o">-</span><span class="n">build</span> <span class="o">--</span><span class="n">arch</span><span class="o">=</span><span class="n">x86_64</span> <span class="o">--</span><span class="n">topurl</span><span class="o">=</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">kojipkgs</span><span class="o">.</span><span class="n">fedoraproject</span><span class="o">.</span><span class="n">org</span><span class="o">/</span> <span class="n">dist</span><span class="o">-</span><span class="n">f12</span>
</pre></div>
</div>
<p>you will need to pass in –topurl=https://kojipkgs.fedoraproject.org/ to
any mock-config command to get a working mock-config from fedoras koji.</p>
</div>
<div class="section" id="tuning-mock-s-behavior-per-tag">
<span id="tuning-mock-per-tag"></span><h4>Tuning mock’s behavior per tag<a class="headerlink" href="#tuning-mock-s-behavior-per-tag" title="Permalink to this headline"></a></h4>
<p>Few options for mock can be configured per-tag. These options are stored in
tag info’s <em>extra</em> field. Extra values can be checked via <cite>koji taginfo</cite>
command.  Example for forcing <cite>dnf</cite> usage in specific build
environment follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">koji</span> <span class="n">edit</span><span class="o">-</span><span class="n">tag</span> <span class="n">dnf</span><span class="o">-</span><span class="n">fedora</span><span class="o">-</span><span class="n">tag</span> <span class="o">-</span><span class="n">x</span> <span class="n">mock</span><span class="o">.</span><span class="n">package_manager</span><span class="o">=</span><span class="n">dnf</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">mock.package_manager</span></code> - If this is set, it will override mock’s default
package manager. Typically used with <code class="docutils literal notranslate"><span class="pre">yum</span></code> or <code class="docutils literal notranslate"><span class="pre">dnf</span></code> values.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mock.new_chroot</span></code> - 0/1 value. If it is set, <code class="docutils literal notranslate"><span class="pre">--new-chroot</span></code> or
<cite>–old-chroot</cite> option is appended to any mock call. If it is not set,
mock’s default behavior is used.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mock.use_bootstrap</span></code> - 0/1 value. If it is set, <code class="docutils literal notranslate"><span class="pre">--bootstrap-chroot</span></code>
is appended to the mock init call.  This tells mock to build in two stages,
using chroot rpm for creating the build chroot. If it is not set, mock’s
default behaviour is used. (Note, that it changed in mock <a class="reference external" href="https://github.com/rpm-software-management/mock/wiki/Feature-bootstrap">1.4.1</a>.
Note, that it is not turn on by default by koji, as it is often not needed and
it consumes additional resources (larger buildroot, downloading more data).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mock.bootstrap_image</span></code> - set to name of image, which can builder’s podman
download (e.g. <code class="docutils literal notranslate"><span class="pre">fedora:32</span></code>). See mock’s <a class="reference external" href="https://github.com/rpm-software-management/mock/wiki/Feature-container-for-bootstrap">doc</a>
before using this. You could need it, but do it with following
recommendations:</p>
<ul>
<li><p>you need to explicitly allow builders to do that (<code class="docutils literal notranslate"><span class="pre">mock_bootstrap_image</span> <span class="pre">=</span>
<span class="pre">True</span></code> in <code class="docutils literal notranslate"><span class="pre">kojid.conf</span></code>).</p></li>
<li><p>you need to have builders with <a class="reference external" href="https://podman.io/">podman</a> installed and
working.</p></li>
<li><p>use concrete hashes not potentially moving tags. Otherwise, you can get into
harder debugging and auditing.</p></li>
<li><p>builders can consume space during time, no cleanup is made for podman’s
image cache. So, you’ll probably want to run something like <code class="docutils literal notranslate"><span class="pre">podman</span> <span class="pre">rmi</span>
<span class="pre">`podman</span> <span class="pre">images</span> <span class="pre">-a</span> <span class="pre">--quiet`</span></code> periodically via cron or use some other
cache-cleaning mechanism. Even simple task will consume roughly three times
more space than without bootstrap image (downloaded image + exploded
bootstrap dir + mock’s buildroot itself)</p></li>
<li><p>be sure, that your podman is configured properly and it downloads images
only from trusted sources. Note, that this setting effectivelly circumvents
network isolation <em>inside</em> buildroot, as outside DNS, etc. can be spoofed.</p></li>
<li><p>this option will automatically turn <code class="docutils literal notranslate"><span class="pre">mock.use_bootstrap</span></code> (this is how
it is implemented in mock)</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">mock.yum.module_hotfixes</span></code> - 0/1 value. If set, yum/dnf will use packages
regardless if they come from modularity repo or not. It makes sense only for
tags with external repositories. (See dnf <a class="reference external" href="https://dnf.readthedocs.io/en/latest/modularity.html#hotfix-repositories">docs</a>)</p></li>
<li><p><a class="reference external" href="https://github.com/rpm-software-management/mock/wiki/Plugin-Sign">mock signing plugin</a> -
Options <code class="docutils literal notranslate"><span class="pre">mock.plugin_conf.sign_enable</span></code>, <code class="docutils literal notranslate"><span class="pre">mock.plugin_conf.sign_opts.cmd</span></code>
and <code class="docutils literal notranslate"><span class="pre">mock.plugin_conf.sign_opts.opts</span></code> are propagated to mock conf to be used
by this plugin. Note, that these tools are run outside of the jailed env.
Note, that this functionality doesn’t interfere with koji’s standard signing
commands (<code class="docutils literal notranslate"><span class="pre">import-sig</span></code>, <code class="docutils literal notranslate"><span class="pre">write-signed-rpm</span></code>, etc.). Note, that rpmsign vs
gpg must be configured correctly. If it is not it a) can silently ignore
problems during signing b) can hang forever when e.g. gpg password store is
not accessible.</p></li>
</ul>
<p>You may also specify per-tag environment variables for mock to use.
For example, to set the CC environment variable to clang, you could
do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">koji</span> <span class="n">edit</span><span class="o">-</span><span class="n">tag</span> <span class="n">dnf</span><span class="o">-</span><span class="n">fedora</span><span class="o">-</span><span class="n">tag</span> <span class="o">-</span><span class="n">x</span> <span class="n">rpm</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">CC</span><span class="o">=</span><span class="n">clang</span>
</pre></div>
</div>
</div>
<div class="section" id="using-koji-to-control-tasks">
<h4>Using Koji to control tasks<a class="headerlink" href="#using-koji-to-control-tasks" title="Permalink to this headline"></a></h4>
<p>List tasks:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">koji</span> <span class="nb">list</span><span class="o">-</span><span class="n">tasks</span>
</pre></div>
</div>
<p>List only tasks requested by you:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">koji</span> <span class="nb">list</span><span class="o">-</span><span class="n">tasks</span> <span class="o">--</span><span class="n">mine</span>
</pre></div>
</div>
<p>requeue an already-processed task: general syntax is: koji resubmit
[options] taskID</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">koji</span> <span class="n">resubmit</span> <span class="mi">3</span>
</pre></div>
</div>
</div>
<div class="section" id="building-a-package-with-the-command-line-tool">
<h4>Building a Package with the command-line tool<a class="headerlink" href="#building-a-package-with-the-command-line-tool" title="Permalink to this headline"></a></h4>
<p>Instead of using the fedpkg target, you can also directly use the
command_line tool, koji.</p>
<p>To build a package, the syntax is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ koji build &lt;build target&gt; &lt;git URL&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ koji build dist-f14 &#39;git url&#39;
</pre></div>
</div>
<p>The koji build command creates a build task in Koji. By default the tool
will wait and print status updates until the build completes. You can
override this with the –nowait option.</p>
</pre><p>NOTE: For fedora koji, the git url MUST be based on
pkgs.fedoraproject.org. Other arbitrary git repos cannot be used for
builds.</p>
</div>
</div>
<div class="section" id="koji-tags-and-packages-organization">
<h3>Koji tags and packages organization<a class="headerlink" href="#koji-tags-and-packages-organization" title="Permalink to this headline"></a></h3>
<div class="section" id="terminology">
<h4>Terminology<a class="headerlink" href="#terminology" title="Permalink to this headline"></a></h4>
<p>In Koji, it is sometimes necessary to distinguish between a package in
general, a specific build of a package, and the various rpm files
created by a build. When precision is needed, these terms should be
interpreted as follows:</p>
<ul class="simple">
<li><p>Package: The name of a source rpm. This refers to the package in
general and not any particular build or subpackage. For example:
kernel, glibc, etc.</p></li>
<li><p>Build: A particular build of a package. This refers to the entire
build: all arches and subpackages. For example: kernel-2.6.9-34.EL,
glibc-2.3.4-2.19.</p></li>
<li><p>RPM: A particular rpm. A specific arch and subpackage of a build. For
example: kernel-2.6.9-34.EL.x86_64, kernel-devel-2.6.9-34.EL.s390,
glibc-2.3.4-2.19.i686, glibc-common-2.3.4-2.19.ia64</p></li>
</ul>
</div>
<div class="section" id="tags-and-targets">
<h4>Tags and targets<a class="headerlink" href="#tags-and-targets" title="Permalink to this headline"></a></h4>
<p>Koji organizes packages using tags. In Koji a tag is roughly a
collection of packages:</p>
<ul class="simple">
<li><p>Tags support inheritance</p></li>
<li><p>Each tag has its own list of valid packages (inheritable)</p></li>
<li><p>Package ownership can be set per-tag (inheritable)</p></li>
<li><p>When you build you specify a target rather than a tag</p></li>
</ul>
<p>A build target specifies where a package should be built and how it
should be tagged afterwards. This allows target names to remain fixed as
tags change through releases.</p>
</div>
<div class="section" id="koji-commands-for-tags">
<h4>Koji commands for tags<a class="headerlink" href="#koji-commands-for-tags" title="Permalink to this headline"></a></h4>
<div class="section" id="targets">
<h5>Targets<a class="headerlink" href="#targets" title="Permalink to this headline"></a></h5>
<p>You can get a full list of build targets with the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ koji list-targets
</pre></div>
</div>
<p>You can see just a single target with the –name option:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ koji list-targets --name dist-f14

Name                           Buildroot                      Destination
---------------------------------------------------------------------------------------------
dist-f14                     dist-f14-build                 dist-f14
</pre></div>
</div>
<p>This tells you a build for target dist-f14 will use a buildroot with
packages from the tag dist-f14-build and tag the resulting packages as
dist-f14.</p>
<p>Watch out: You probably don’t want to build against dist-rawhide. If
Fedora N is the latest one out, to build to the next one, choose
dist-f{N+1}.</p>
</div>
<div class="section" id="tags">
<h5>Tags<a class="headerlink" href="#tags" title="Permalink to this headline"></a></h5>
<p>You can get a list of tags with the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ koji list-tags
</pre></div>
</div>
</div>
<div class="section" id="packages">
<h5>Packages<a class="headerlink" href="#packages" title="Permalink to this headline"></a></h5>
<p>As mentioned above, each tag has its own list of packages that may be
placed in the tag. To see that list for a tag, use the list-pkgs
command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ koji list-pkgs --tag dist-f14
</pre></div>
</div>
<p>The first column is the name of the package, the second tells you which
tag the package entry has been inherited from, and the third tells you
the owner of the package.</p>
</div>
<div class="section" id="latest-builds">
<h5>Latest Builds<a class="headerlink" href="#latest-builds" title="Permalink to this headline"></a></h5>
<p>To see the latest builds for a tag, use the latest-build command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ koji latest-build --all dist-f14
</pre></div>
</div>
<p>The output gives you not only the latest builds, but which tag they have
been inherited from and who built them.</p>
<p><a class="reference external" href="Category:PackageMaintainers">Category:Package Maintainers</a></p>
</div>
</div>
</div>
</div>
<div class="section" id="koji-xmlrpc-api">
<h2>Koji XMLRPC API<a class="headerlink" href="#koji-xmlrpc-api" title="Permalink to this headline"></a></h2>
<p>All features supported by command-line client are also accessible by XMLRPC
API. You can get listing of all available calls, arguments and basic help via
calling <cite>koji list-api</cite> command. This call will also provide you API
extensions provided by plugins in that particular koji instance.</p>
<p>Because of the data Koji routinely deals with, we use the following extensions
to the xmlrpc standard:</p>
<blockquote>
<div><ul class="simple">
<li><p>We use the <code class="docutils literal notranslate"><span class="pre">nil</span></code> extension to represent null values (e.g. None in
Python). Koji’s library handles this automatically. If you are using a
different library, you may need to explicitly enable this (e.g. enabling
allow_none in Python’s own xmlrpc library).</p></li>
<li><p>We represent large integers with the <code class="docutils literal notranslate"><span class="pre">i8</span></code> tag. This standard is borrowed
from Apache’s <cite>ws-xmlrpc &lt;https://ws.apache.org/xmlrpc/types.html&gt;</cite>
implementation. Python’s own xmlrpc library understands this tag, even
thought it will not emit it.</p></li>
</ul>
</div></blockquote>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="User Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../Developer%20Guide/index.html" class="btn btn-neutral float-right" title="Developer Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, Mike McLean, Mike B, Dennis Gilmore, Mathieu Bridon, Ian McLeod, Ralph Bean, Adam Miller.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>