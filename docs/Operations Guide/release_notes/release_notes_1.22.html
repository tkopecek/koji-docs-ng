<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Koji 1.22.0 Release notes &mdash; Koji alpha documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Koji 1.21.1 Release notes" href="release_notes_1.21.1.html" />
    <link rel="prev" title="Koji 1.22.1 Release notes" href="release_notes_1.22.1.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Koji
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../introduction.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Operations Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../server_howto.html">Server Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../server_bootstrap.html">Koji Server Bootstrap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../external_repo_server_bootstrap.html">External Repository Server Bootstrap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kerberos_gssapi_debug.html">Koji Kerberos/GSSAPI debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kojid_conf.html">kojid.conf Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hub_conf.html">hub.conf options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../database_howto.html">Database Performance Howto</a></li>
<li class="toctree-l2"><a class="reference internal" href="../image_build.html">Building Images in Koji</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins.html">Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="../supported_platforms.html">Supported Platforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tasks.html">Tasks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utils.html">Koji Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../volumes.html">Storage Volumes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../containers.html">Running Koji in Containers</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../releases.html">Releases</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../CVEs/CVEs.html">Koji CVEs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../migrations/migrations.html">Migrations</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="release_notes.html">Release Notes</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="release_notes_1.27.html">Koji 1.27.0 Release notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="release_notes_1.26.1.html">Koji 1.26.1 Release notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="release_notes_1.26.html">Koji 1.26.0 Release notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="release_notes_1.25.1.html">Koji 1.25.1 Release notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="release_notes_1.25.html">Koji 1.25.0 Release notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="release_notes_1.24.1.html">Koji 1.24.1 Release notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="release_notes_1.24.html">Koji 1.24.0 Release notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="release_notes_1.23.1.html">Koji 1.23.1 Release notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="release_notes_1.23.html">Koji 1.23.0 Release notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="release_notes_1.22.1.html">Koji 1.22.1 Release notes</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Koji 1.22.0 Release notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="release_notes_1.21.1.html">Koji 1.21.1 Release notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="release_notes_1.21.html">Koji 1.21.0 Release notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="release_notes_1.20.1.html">Koji 1.20.1 Release notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="release_notes_1.20.html">Koji 1.20.0 Release notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="release_notes_1.19.1.html">Koji 1.19.1 Release notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="release_notes_1.19.html">Koji 1.19.0 Release notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="release_notes_1.18.1.html">Koji 1.18.1 Release Notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="release_notes_1.18.html">Koji 1.18.0 Release notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="release_notes_1.17.html">Koji 1.17.0 Release notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="release_notes_1.16.2.html">Koji 1.16.2 Release Notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="release_notes_1.16.1.html">Koji 1.16.1 Release Notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="release_notes_1.16.html">Koji 1.16.0 Release notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="release_notes_1.15.1.html">Koji 1.15.1 Release Notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="release_notes_1.15.html">Koji 1.15 Release Notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="release_notes_1.14.html">Koji 1.14 Release Notes</a></li>
<li class="toctree-l4"><a class="reference internal" href="release_notes_1.13.html">Koji 1.13 Release Notes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../Administration%20Guide/index.html">Administration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../User%20Guide/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Developer%20Guide/index.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../HOWTO.html">Koji HOWTO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc.html">Koji Miscellaneous Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../runs_here.html">Runs Here</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Koji</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Operations Guide</a> &raquo;</li>
          <li><a href="../releases.html">Releases</a> &raquo;</li>
          <li><a href="release_notes.html">Release Notes</a> &raquo;</li>
      <li>Koji 1.22.0 Release notes</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/Operations Guide/release_notes/release_notes_1.22.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="koji-1-22-0-release-notes">
<h1>Koji 1.22.0 Release notes<a class="headerlink" href="#koji-1-22-0-release-notes" title="Permalink to this headline"></a></h1>
<p>Important: python 2 support for hub and web have been dropped in koji 1.22,
meanwhile CLI and builder are still supporting python2. Please prepare your hub
and web service for python3 if you are going to upgrade them to koji 1.22.</p>
<p>All changes can be found at <a class="reference external" href="https://pagure.io/koji/roadmap/1.22/">pagure</a>.
Most important changes are listed here.</p>
<div class="section" id="migrating-from-koji-1-21-1-21-1">
<h2>Migrating from Koji 1.21/1.21.1<a class="headerlink" href="#migrating-from-koji-1-21-1-21-1" title="Permalink to this headline"></a></h2>
<p>For details on migrating see <a class="reference internal" href="../migrations/migrating_to_1.22.html"><span class="doc">Migrating to Koji 1.22</span></a></p>
</div>
<div class="section" id="security-fixes">
<h2>Security Fixes<a class="headerlink" href="#security-fixes" title="Permalink to this headline"></a></h2>
<p>None</p>
</div>
<div class="section" id="client-changes">
<h2>Client Changes<a class="headerlink" href="#client-changes" title="Permalink to this headline"></a></h2>
<p><strong>Output extra[‘rpm.macro.*’] to mock-config</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2255">https://pagure.io/koji/pull-request/2255</a></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">mock-config</span></code> command honors ‘rpm.macro.*’ options in tag’s extra config now.</p>
<p><strong>–ca option has been deprecated</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2182">https://pagure.io/koji/pull-request/2182</a></div>
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2246">https://pagure.io/koji/pull-request/2246</a></div>
</div>
<p>This option is deprecated for a while and not used internally. We added the
deprecation warning and will finally remove it in 1.24.
Notes: It is deprecated in koji-gc as well.</p>
<p><strong>Flush stdout during watch-logs</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2228">https://pagure.io/koji/pull-request/2228</a></div>
</div>
<p>Calling <code class="docutils literal notranslate"><span class="pre">flush()</span></code> immediately to display the output faster for PY3.</p>
<p><strong>Do not try unnecessary authentication</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2228">https://pagure.io/koji/pull-request/2228</a></div>
</div>
<p>In some CLI commands we used <code class="docutils literal notranslate"><span class="pre">active_session()</span></code> which will try its best to
login, but it is not necessary. Now, we only ensure the connection without
authentication.</p>
<p><strong>Unify –debug options</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2085">https://pagure.io/koji/pull-request/2085</a></div>
</div>
<p>The cli accepts a global <code class="docutils literal notranslate"><span class="pre">--debug</span></code> option before the command name.
Some commands accepted a separate <code class="docutils literal notranslate"><span class="pre">--debug</span></code> option local to the command,
which was confusing.
Now these commands take their cue from the global option.
The local option is still accepted for backwards compatibility, though
it has been hidden in the help output.</p>
<p>The following commands were affected:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">prune-sigs</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">list-signed</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">list-tag-history</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">list-history</span></code></p></li>
</ul>
<p><strong>New option –wait for download-task</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2346">https://pagure.io/koji/pull-request/2346</a></div>
</div>
<p>This is a UE enhancement to let the command be able to wait for the tasks to be
finished as the same as the behavior of <code class="docutils literal notranslate"><span class="pre">build</span></code> command.</p>
<p><strong>Fix image-build-indirection –wait</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2347">https://pagure.io/koji/pull-request/2347</a></div>
</div>
<p>Previously, the <code class="docutils literal notranslate"><span class="pre">image-build-indirection</span></code> command accepted the <code class="docutils literal notranslate"><span class="pre">--wait</span></code>
option, but did not honor it.
This oversight has been fixed.</p>
<p><strong>Fix event option handling in clone-tag</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2364">https://pagure.io/koji/pull-request/2364</a></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">getTag()</span></code> call for fetching source tag info in <code class="docutils literal notranslate"><span class="pre">clone_tag</span></code> didn’t use event
before. Now, it does.</p>
</div>
<div class="section" id="library-changes">
<h2>Library Changes<a class="headerlink" href="#library-changes" title="Permalink to this headline"></a></h2>
<p><strong>Correctly identify “hostname doesn’t match” errors</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2266">https://pagure.io/koji/pull-request/2266</a></div>
</div>
<p>“hostname doesn’t match” can be identified as a certificate error, so that
client will not retry the request.</p>
<p><strong>openRemoteFile retries and checks downloaded content</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2254">https://pagure.io/koji/pull-request/2254</a></div>
</div>
<p>Sometimes we hit a problem with incorrect downloads caused by various
malfunctions, like cache, filesystem, network, etc. Now, in
<code class="docutils literal notranslate"><span class="pre">openRemoteFile</span></code>, we are going to</p>
<ul class="simple">
<li><p>compare http’s <code class="docutils literal notranslate"><span class="pre">Content-Length</span></code> header with the data we really downloaded</p></li>
<li><p>check the rpm header is valid if the file is an RPM</p></li>
<li><p>do 3 times retries if it fails</p></li>
</ul>
</div>
<div class="section" id="api-changes">
<h2>API Changes<a class="headerlink" href="#api-changes" title="Permalink to this headline"></a></h2>
<p><strong>filterResults and countAndFilterResults raise GenericError</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2150">https://pagure.io/koji/pull-request/2150</a></div>
</div>
<p>API <code class="docutils literal notranslate"><span class="pre">filterResults</span></code> and <code class="docutils literal notranslate"><span class="pre">countAndFilterResults</span></code> now raise
<code class="docutils literal notranslate"><span class="pre">koji.GenericError</span></code> instead of <code class="docutils literal notranslate"><span class="pre">xmlrpc.client.Fault</span></code> when method’s keyword
argument is not expected.</p>
<p><strong>Deprecation of host.getTask call</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2238">https://pagure.io/koji/pull-request/2238</a></div>
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2264">https://pagure.io/koji/pull-request/2264</a></div>
</div>
<p>This host API will be finally removed in 1.23</p>
<p><strong>Optimizations to the listBuildroots call</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2299">https://pagure.io/koji/pull-request/2299</a></div>
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2303">https://pagure.io/koji/pull-request/2303</a></div>
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2301">https://pagure.io/koji/pull-request/2301</a></div>
</div>
<p>For the optimization purpose, the <code class="docutils literal notranslate"><span class="pre">listBuildroots</span></code> API call avoids
unnecessary checks when the return will be empty.</p>
<p>Additionally, the call avoids some table joins that can slow down the queries
in some cases.
As a result, the return value will no longer include the <code class="docutils literal notranslate"><span class="pre">is_update</span></code> field
when querying by <code class="docutils literal notranslate"><span class="pre">rpmID</span></code>.</p>
<p><strong>Disable notifications by default in [un]tagBuildBypass calls</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/issue/2292">https://pagure.io/koji/issue/2292</a></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">notify</span></code> option to the <code class="docutils literal notranslate"><span class="pre">tagBuildBypass</span></code> and <code class="docutils literal notranslate"><span class="pre">untagBuildBypass</span></code> now defaults to False.
Tools that wish to generate email notifications will need to explicitly pass <code class="docutils literal notranslate"><span class="pre">notify=True</span></code>.</p>
<p><strong>Fix a typo in the error message of getChangelogEntries</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2338">https://pagure.io/koji/pull-request/2338</a></div>
</div>
<p><strong>A new option - pattern for listTags call</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2320">https://pagure.io/koji/pull-request/2320</a></div>
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2348">https://pagure.io/koji/pull-request/2348</a></div>
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2387">https://pagure.io/koji/pull-request/2387</a></div>
</div>
<p>This option is a GLOB match pattern for the name of tag. You can now directly
call <code class="docutils literal notranslate"><span class="pre">session.listTags(pattern='prefix-*-postfix')</span></code> for example, to filter the
result list on server side. The <code class="docutils literal notranslate"><span class="pre">list-tags</span></code> command tries its best to call it with
<code class="docutils literal notranslate"><span class="pre">pattern</span></code> as well.</p>
</div>
<div class="section" id="builder-changes">
<h2>Builder Changes<a class="headerlink" href="#builder-changes" title="Permalink to this headline"></a></h2>
<p><strong>Koji now supports Mock’s bootstrap chroot and image</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2166">https://pagure.io/koji/pull-request/2166</a></div>
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2212">https://pagure.io/koji/pull-request/2212</a></div>
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2372">https://pagure.io/koji/pull-request/2372</a></div>
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2328">https://pagure.io/koji/pull-request/2328</a></div>
</div>
<p>Koji now supports Mock’s <code class="docutils literal notranslate"><span class="pre">--bootstrap-chroot</span></code> and <code class="docutils literal notranslate"><span class="pre">--bootstrap-image</span></code>
options. See:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/rpm-software-management/mock/wiki/Feature-bootstrap">Bootstrap chroot</a></p></li>
<li><p><a class="reference external" href="https://github.com/rpm-software-management/mock/wiki/Feature-container-for-bootstrap">Container for bootstrap</a></p></li>
</ul>
<p>For the configuration on koji, please refer to <span class="xref std std-doc">../using_the_koji_build_system</span>.
The bootstrap buildroot will be pruned automatically by kojid as the same as the
normal buildroot.</p>
<p><strong>Pass bootloader append option to livemedia builds</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2262">https://pagure.io/koji/pull-request/2262</a></div>
</div>
<p>Koji is now able to pass <code class="docutils literal notranslate"><span class="pre">--extra-boot-args</span> <span class="pre">--append=&quot;bootloader</span> <span class="pre">--append&quot;</span></code>
options to <code class="docutils literal notranslate"><span class="pre">livemedia-creator</span></code> tool for livemedia builds.</p>
<p><strong>Per-tag environment variables in Mock’s buildroot</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2064">https://pagure.io/koji/pull-request/2064</a></div>
</div>
<p>Now, you can set <code class="docutils literal notranslate"><span class="pre">rpm.env.*</span></code> in build tag’s <code class="docutils literal notranslate"><span class="pre">extra</span></code> to specify environment
variables in mock’s buildroot. See <span class="xref std std-doc">../using_the_koji_build_system</span>.</p>
<p><strong>Support specific per-settings for Mock’s sign plugin</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/1932">https://pagure.io/koji/pull-request/1932</a></div>
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2337">https://pagure.io/koji/pull-request/2337</a></div>
</div>
<p>We are now providing <code class="docutils literal notranslate"><span class="pre">mock.plugin_conf.sign_enable</span></code>,
<code class="docutils literal notranslate"><span class="pre">mock.plugin_conf.sign_opts.cmd</span></code> and <code class="docutils literal notranslate"><span class="pre">mock.plugin_conf.sign_opts.opts</span></code> in
build tag’s <code class="docutils literal notranslate"><span class="pre">extra</span></code> for enabling and configuring the sign plugin of mock. For
more details, see <span class="xref std std-doc">../using_the_koji_build_system</span>.</p>
<p><strong>Per-tag settings of yum’s depsolver policy for Mock</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/1932">https://pagure.io/koji/pull-request/1932</a></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">mock.yum.best=0/1</span></code> is available in tag’s extra config for the corresponding
setting of mock config.</p>
<p><strong>Use mergerepo_c for all merge modes</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2376">https://pagure.io/koji/pull-request/2376</a></div>
</div>
<p>As <code class="docutils literal notranslate"><span class="pre">mergerepo_c</span></code> has supported <code class="docutils literal notranslate"><span class="pre">simple</span></code> mode since 0.13.0, we now use it on
python3 or <code class="docutils literal notranslate"><span class="pre">use_createrepo_c=True</span></code> kojid for repo creation. And as <a class="reference external" href="https://github.com/rpm-software-management/createrepo_c/issues/213">issues/213</a> of
<code class="docutils literal notranslate"><span class="pre">createrepo_c</span></code> has been fixed in 0.15.11, we also append <code class="docutils literal notranslate"><span class="pre">--arch-expand</span></code> on
demand. Therefore, koji are now able to use <code class="docutils literal notranslate"><span class="pre">mergerepo_c</span></code> for all 3 modes: koji,
simple, bare. Nevertheless, we are still providing <code class="docutils literal notranslate"><span class="pre">mergerepos</span></code> scripts for
python2.</p>
<p><strong>Turn off dnf_warning in mock.cfg</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2353">https://pagure.io/koji/pull-request/2353</a></div>
</div>
<p>In <a class="reference external" href="https://pagure.io/koji/pull-request/1595">PR #1595</a>, we set
<code class="docutils literal notranslate"><span class="pre">dnf_warning=True</span></code> when we started to add this configuration. But since Mock
2.0, <code class="docutils literal notranslate"><span class="pre">bootstrap_chroot</span></code> is set to <code class="docutils literal notranslate"><span class="pre">True</span></code> by default, we need to set
<code class="docutils literal notranslate"><span class="pre">dnf_warning</span></code> to <code class="docutils literal notranslate"><span class="pre">False</span></code> accordingly. For the details, please refer to
<a class="reference external" href="https://pagure.io/koji/issue/2026">issue #2026</a>.</p>
<p><strong>BuildSRPMFromSCMTask: Support auto-selecting a matching specfile name</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2257">https://pagure.io/koji/pull-request/2257</a></div>
</div>
<p>When building SRPM from SCM, if there are more than one <code class="docutils literal notranslate"><span class="pre">*.spec</span></code> found in root
directory, or <code class="docutils literal notranslate"><span class="pre">support_rpm_source_layout=yes</span></code> in <code class="docutils literal notranslate"><span class="pre">/etc/kojid/kojid.conf</span></code> and
there are more than one <code class="docutils literal notranslate"><span class="pre">*.spec</span></code> found in <code class="docutils literal notranslate"><span class="pre">SPECS</span></code> directory, the builder is
going to use the specfile with the SCM repo’s name in root or <code class="docutils literal notranslate"><span class="pre">SPECS</span></code> dir.</p>
<p><strong>Pass buildroot to preSCMCheckout and postSCMCheckout where applicable</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2123">https://pagure.io/koji/pull-request/2123</a></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">preSCMCheckout</span></code> and <code class="docutils literal notranslate"><span class="pre">postSCMCheckout</span></code> callbacks for kojid now include
a <code class="docutils literal notranslate"><span class="pre">buildroot</span></code> field that provides access to the internal <code class="docutils literal notranslate"><span class="pre">BuildRoot</span></code>
object, when such an object is available.
This change impacts <code class="docutils literal notranslate"><span class="pre">BuildMavenTask</span></code>, <code class="docutils literal notranslate"><span class="pre">WrapperRPMTask</span></code>, <code class="docutils literal notranslate"><span class="pre">ImageTask</span></code> and
<code class="docutils literal notranslate"><span class="pre">BuildSRPMfromRPMTask</span></code>.
The current exceptions are <code class="docutils literal notranslate"><span class="pre">OzImageTask</span></code> and <code class="docutils literal notranslate"><span class="pre">BuildIndirectionImageTask</span></code>,
which do not use this type of buildroot.</p>
<p>Any plugins that use this field should be aware that the behavior of this class
may change across releases.</p>
</div>
<div class="section" id="web-ui-changes">
<h2>Web UI Changes<a class="headerlink" href="#web-ui-changes" title="Permalink to this headline"></a></h2>
<p><strong>A new repoinfo page</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2193">https://pagure.io/koji/pull-request/2193</a></div>
</div>
<p>The new page displays basic information of a normal repo, linked by the repo id
on taskinfo and buildrootinfo page.</p>
</div>
<div class="section" id="win-builder-changes">
<h2>Win Builder Changes<a class="headerlink" href="#win-builder-changes" title="Permalink to this headline"></a></h2>
<p><strong>Clone mac address via xml</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2290">https://pagure.io/koji/pull-request/2290</a></div>
</div>
<p>We’ve hit a problem that while VM is being cloned, the mac address cloning is
refused and a new one is assigned instead. We are now using the xml file for mac
address setup.</p>
</div>
<div class="section" id="system-changes">
<h2>System Changes<a class="headerlink" href="#system-changes" title="Permalink to this headline"></a></h2>
<p><strong>Drop python2 support for hub and web</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2218">https://pagure.io/koji/pull-request/2218</a></div>
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2342">https://pagure.io/koji/pull-request/2342</a></div>
</div>
<p>Finally, python2 support for hub and web have been dropped in this release.</p>
<p><strong>Drop krbV support</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2244">https://pagure.io/koji/pull-request/2244</a></div>
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2151">https://pagure.io/koji/pull-request/2151</a></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">krbV</span></code> support has been finally removed from this release. For more information, please refer to
<a class="reference internal" href="../migrations/migrating_to_1.22.html#migration-krbv"><span class="std std-ref">Dropped krbV authentication support</span></a>.</p>
<p><strong>Use requests_gssapi for GSSAPI authentication</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2244">https://pagure.io/koji/pull-request/2244</a></div>
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2401">https://pagure.io/koji/pull-request/2401</a></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">requests_gssapi</span></code> is supported in this release. In all of the components we provide, we now try to
use <code class="docutils literal notranslate"><span class="pre">request_gssapi</span></code> at first, if it isn’t installed, fallback to <code class="docutils literal notranslate"><span class="pre">requests_kerberos</span></code> then.</p>
<p><strong>DB: Use timestamps with timezone</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2237">https://pagure.io/koji/pull-request/2237</a></div>
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2366">https://pagure.io/koji/pull-request/2366</a></div>
</div>
<p>We have updated all our timestamp fields to include timezone.
This prevents time inconsistencies when the database has a timezone setting
other than UTC.</p>
<p><strong>DB: Update sessions_active_and_recent index</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2334">https://pagure.io/koji/pull-request/2334</a></div>
</div>
<p>We have adjusted the <code class="docutils literal notranslate"><span class="pre">sessions_active_and_recent</span></code> index so that the planner
will actually use it.</p>
<p><strong>Log tracebacks for multicall</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2225">https://pagure.io/koji/pull-request/2225</a></div>
</div>
<p>The exceptions inside multicall were not logged before. These tracebacks will
benefit us for debugging purpose, as we are often using multicall more and more.</p>
<p><strong>Fix build_notification crashing caused by recipients check</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2308">https://pagure.io/koji/pull-request/2308</a></div>
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2309">https://pagure.io/koji/pull-request/2309</a></div>
</div>
<p>This change fixes an inconsistency in the function where it would return
<code class="docutils literal notranslate"><span class="pre">None</span></code> instead of an empty list as expected.</p>
<p><strong>Allow packagelist changes with ‘tag’ permission by the default policy</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2275">https://pagure.io/koji/pull-request/2275</a></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">tag</span></code> permission was introduced in version 1.18 as part of an effort to
make admin permissions more granular.
This permission now grants access to make package list changes for tags
via the default <code class="docutils literal notranslate"><span class="pre">package_list</span></code> policy.</p>
<p><strong>Improve race condition for getNextRelease call and images</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2263">https://pagure.io/koji/pull-request/2263</a></div>
</div>
<p>It was possible to meet the race condition in the old logic of image building.
We are now calling <code class="docutils literal notranslate"><span class="pre">get_next_release()</span></code> in the <code class="docutils literal notranslate"><span class="pre">initImageBuild</span></code> call if there is
ino release passed in, rather than calling <code class="docutils literal notranslate"><span class="pre">getNextRelease</span></code> in the ImageBuild
task individually. This would notably reduce the possibility of the race
condition.</p>
<p><strong>Replace MD5 with SHA-256 in most places</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2317">https://pagure.io/koji/pull-request/2317</a></div>
</div>
<p>Koji should work on the FIPS enabled system where MD5 is disabled for security
reason. We are now using SHA-256 to replace MD5 for web token and file uploading,
but only keeping MD5 for RPM file processing.</p>
<p><strong>Remove “GssapiSSLonly Off” option</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2162">https://pagure.io/koji/pull-request/2162</a></div>
</div>
<p>We have removed the <code class="docutils literal notranslate"><span class="pre">GssapiSSLonly</span></code> option from our example httpd
configuration.
It was previously shown in the example, set to <code class="docutils literal notranslate"><span class="pre">Off</span></code>.
This is also the default in mod_auth_gssapi, but <em>it is not the recommended
setting</em>.
For more information, see <a class="reference external" href="https://github.com/gssapi/mod_auth_gssapi#gssapisslonly">mod_auth_gssapi doc</a></p>
<p><strong>Remove “GssapiLocalName Off” option</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2351">https://pagure.io/koji/pull-request/2351</a></div>
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2358">https://pagure.io/koji/pull-request/2358</a></div>
</div>
<p>We have also removed the <code class="docutils literal notranslate"><span class="pre">GssapiLocalName</span></code> option from our example httpd
configurations.
Similar to the above, our example setting was already the default.</p>
<p><strong>Provide task-based data to volume policy</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2306">https://pagure.io/koji/pull-request/2306</a></div>
</div>
<p>For builds with associated tasks, more information is now available to the volume policy.
In particular, the <code class="docutils literal notranslate"><span class="pre">buildtag</span></code> policy test should work for such builds.</p>
<p>Note that some builds (e.g. content generator builds and other imported builds) do not
have associated tasks.</p>
<p>For more information on hub policies, see <span class="xref std std-doc">../defining_hub_policies</span>.</p>
<p><strong>Honor volume policy in host.importImage</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2359">https://pagure.io/koji/pull-request/2359</a></div>
</div>
<p>This fixes a bug where an underlying function as ignoring the volume policy result.</p>
</div>
<div class="section" id="plugins">
<h2>Plugins<a class="headerlink" href="#plugins" title="Permalink to this headline"></a></h2>
<div class="section" id="sidetag">
<h3>sidetag<a class="headerlink" href="#sidetag" title="Permalink to this headline"></a></h3>
<p><strong>listSideTags also returns user info</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2132">https://pagure.io/koji/pull-request/2132</a></div>
</div>
<p>We now provide an easier way to find the owner of sidetags</p>
<p><strong>Give koji admins the permission to operate sidetags</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2322">https://pagure.io/koji/pull-request/2322</a></div>
</div>
<p>Users with the <code class="docutils literal notranslate"><span class="pre">admin</span></code> permission can now manage sidetags even if they are
not their own.</p>
<p><strong>Fix is_sidetag_owner and is_sidetag policy tests</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2326">https://pagure.io/koji/pull-request/2326</a></div>
</div>
<p>These policy tests would previously always return a null result.
Now they return the correct one.</p>
</div>
</div>
<div class="section" id="utilities-changes">
<h2>Utilities Changes<a class="headerlink" href="#utilities-changes" title="Permalink to this headline"></a></h2>
<div class="section" id="garbage-collector">
<h3>Garbage Collector<a class="headerlink" href="#garbage-collector" title="Permalink to this headline"></a></h3>
<p><strong>Systemd units for koji-gc</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2199">https://pagure.io/koji/pull-request/2199</a></div>
</div>
<p>The systemd units(service and timer) are now installed by default.</p>
<p><strong>Allow specifying CC and BCC address for email notifications</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2195">https://pagure.io/koji/pull-request/2195</a></div>
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2278">https://pagure.io/koji/pull-request/2278</a></div>
</div>
<p>New options <code class="docutils literal notranslate"><span class="pre">cc_addr</span></code>, <code class="docutils literal notranslate"><span class="pre">bcc_addr</span></code> in config file, or CLI options
<code class="docutils literal notranslate"><span class="pre">--cc-addr</span></code>, <code class="docutils literal notranslate"><span class="pre">--bcc-addr</span></code> are available now.</p>
<p><strong>Set smtp_host to localhost by default</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2253">https://pagure.io/koji/pull-request/2253</a></div>
</div>
<p>The previous the default value was <code class="docutils literal notranslate"><span class="pre">None</span></code>, which would cause failures
if notifications were enabled.</p>
</div>
<div class="section" id="kojira">
<h3>Kojira<a class="headerlink" href="#kojira" title="Permalink to this headline"></a></h3>
<p><strong>New option: queue_file for task queue monitoring</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2024">https://pagure.io/koji/pull-request/2024</a></div>
</div>
<p>With a writable filepath specified, the state information will be saved into
this file in each cycle. For more information, please refer to
<a class="reference internal" href="../utils.html#utils-kojira"><span class="std std-ref">Kojira</span></a>.</p>
<p><strong>Use mtime of repo directory to determine the age</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2154">https://pagure.io/koji/pull-request/2154</a></div>
</div>
<p>Kojira should now do a better job of determining the age of a repo at startup.</p>
<p><strong>Fix logic detecting directories for pruneLocalRepos</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2323">https://pagure.io/koji/pull-request/2323</a></div>
</div>
<p>The condition was opposite before.</p>
<p><strong>Totally drop SysV support</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/issue/2171">https://pagure.io/koji/issue/2171</a></div>
</div>
<p>Thus, we won’t provide kojira service on &lt;=EL6 platform.</p>
<p><strong>Repo deletion within thread</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2340">https://pagure.io/koji/pull-request/2340</a></div>
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2397">https://pagure.io/koji/pull-request/2397</a></div>
</div>
<p>Kojira are now able to delete repos in a separated thread.
The old <code class="docutils literal notranslate"><span class="pre">delete_batch_size</span></code> option is no longer used and has been removed.</p>
</div>
<div class="section" id="koji-sidetag-cleanup">
<h3>koji-sidetag-cleanup<a class="headerlink" href="#koji-sidetag-cleanup" title="Permalink to this headline"></a></h3>
<p><strong>Set the shebang to /usr/bin/python2 on RHEL&lt;=7</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2209">https://pagure.io/koji/pull-request/2209</a></div>
</div>
<p>Otherwise, the build will fail on RHEL&lt;=7.</p>
</div>
<div class="section" id="koji-sweep-db">
<h3>koji-sweep-db<a class="headerlink" href="#koji-sweep-db" title="Permalink to this headline"></a></h3>
<p><strong>use “Type=oneshot” for systemd</strong></p>
<div class="line-block">
<div class="line">PR: <a class="reference external" href="https://pagure.io/koji/pull-request/2187">https://pagure.io/koji/pull-request/2187</a></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">oneshot</span></code> is the appropriate choice for periodic cleanup scripts, see <a class="reference external" href="https://www.freedesktop.org/software/systemd/man/systemd.service.html#Type=">systemd
docs</a>.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="release_notes_1.22.1.html" class="btn btn-neutral float-left" title="Koji 1.22.1 Release notes" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="release_notes_1.21.1.html" class="btn btn-neutral float-right" title="Koji 1.21.1 Release notes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, Mike McLean, Mike B, Dennis Gilmore, Mathieu Bridon, Ian McLeod, Ralph Bean, Adam Miller.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>