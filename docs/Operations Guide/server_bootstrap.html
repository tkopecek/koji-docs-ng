<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Koji Server Bootstrap &mdash; Koji alpha documentation</title><link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Storage Volumes" href="volumes.html" />
    <link rel="prev" title="Server Installation" href="server_howto.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Koji
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Operations Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="server_howto.html">Server Installation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Koji Server Bootstrap</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#bootstrapping-a-new-koji-build-environment">Bootstrapping a new Koji build environment</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="volumes.html">Storage Volumes</a></li>
<li class="toctree-l2"><a class="reference internal" href="external_repo_server_bootstrap.html">External Repository Server Bootstrap</a></li>
<li class="toctree-l2"><a class="reference internal" href="kerberos_gssapi_debug.html">Koji Kerberos/GSSAPI debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="kojid_conf.html">Builder Configuration Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="hub_conf.html">Hub Configuration Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="database_howto.html">Database Performance Howto</a></li>
<li class="toctree-l2"><a class="reference internal" href="image_build.html">Building Images in Koji</a></li>
<li class="toctree-l2"><a class="reference internal" href="plugins.html">Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="utils.html">Koji Utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="tasks.html">Tasks Description</a></li>
<li class="toctree-l2"><a class="reference internal" href="containers.html">Running Koji in Containers</a></li>
<li class="toctree-l2"><a class="reference internal" href="supported_platforms.html">Supported Platforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="releases.html">Releases</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Administration Guide/index.html">Administration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../User Guide/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Developer Guide/index.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../runs_here.html">Runs Here</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Koji</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Operations Guide</a> &raquo;</li>
      <li>Koji Server Bootstrap</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/Operations Guide/server_bootstrap.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="koji-server-bootstrap">
<h1>Koji Server Bootstrap<a class="headerlink" href="#koji-server-bootstrap" title="Permalink to this headline">¶</a></h1>
<div class="section" id="bootstrapping-a-new-koji-build-environment">
<h2>Bootstrapping a new Koji build environment<a class="headerlink" href="#bootstrapping-a-new-koji-build-environment" title="Permalink to this headline">¶</a></h2>
<p>These are the steps involved in populating a new Koji server with
packages so that it can be used for building. This assumes that the Koji
hub is up, appropriate authentication methods have been configured, the
Koji repo administration daemon (<code class="docutils literal notranslate"><span class="pre">kojira</span></code>) is properly configured and
running, and at least one Koji builder (<code class="docutils literal notranslate"><span class="pre">kojid</span></code>) is properly
configured and running. All koji cli commands assume that the user is a
Koji <em>admin</em>. If you need help with these tasks, see the
<a class="reference internal" href="server_howto.html"><span class="doc">installation instructions</span></a>.</p>
<ul class="simple">
<li><p>Download all source rpms and binary rpms for the arches you’re
interested in</p></li>
<li><p>Import all source rpms</p></li>
</ul>
<p>There is a second option if you’re not planning to import all the rpms into your
own instance. In such case you can rely on external content which is described
in <a class="reference internal" href="external_repo_server_bootstrap.html"><span class="doc">External Repository Server Bootstrap</span></a> section. Otherwise, continue here.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> koji import /path/to/package1.src.rpm /path/to/package2.src.rpm ...
</pre></div>
</div>
<p>If the files are on the same volume as /mnt/koji, you can use
<code class="docutils literal notranslate"><span class="pre">koji</span> <span class="pre">import</span> <span class="pre">--link</span></code>, which hardlinks the files into place, avoiding
the need to upload them to the hub and <strong>very significantly</strong> increasing
import speed. When using <code class="docutils literal notranslate"><span class="pre">--link</span></code>, you must run as root. It is
<strong>highly</strong> recommended that you use <code class="docutils literal notranslate"><span class="pre">--link</span></code>.</p>
<ul class="simple">
<li><p>Import all binary rpms using the same method as above</p></li>
<li><p>Create a new tag</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> koji add-tag dist-foo
</pre></div>
</div>
<ul class="simple">
<li><p>Tag all of the packages you just imported into the tag you just
created</p></li>
</ul>
<p>You can use <code class="docutils literal notranslate"><span class="pre">koji</span> <span class="pre">list-untagged</span></code> to get a list of all of the packages
you just imported.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> koji list-pkgs --quiet <span class="p">|</span> xargs koji add-pkg --owner &lt;kojiuser&gt; dist-foo
<span class="gp">$</span> koji list-untagged <span class="p">|</span> xargs -n <span class="m">1</span> koji call tagBuildBypass dist-foo
</pre></div>
</div>
<p>We call the <em>tagBuildBypass</em> method instead of using <code class="docutils literal notranslate"><span class="pre">koji</span> <span class="pre">tag-build</span></code>
because it doesn’t require the builders to process <em>tagBuild</em> tasks one
at a time, but does the tagging directly. This will save a significant
amount of time, especially when tagging a large number of packages.</p>
<ul class="simple">
<li><p>Create a build tag with the desired arches, and the previously
created tag as a parent</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> koji add-tag --parent dist-foo --arches <span class="s2">&quot;i386 x86_64 ppc ppc64&quot;</span> dist-foo-build
</pre></div>
</div>
<ul class="simple">
<li><p>Create a build target that includes the tags you’ve already created</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> koji add-target dist-foo dist-foo-build
</pre></div>
</div>
<ul class="simple">
<li><p>Create a <em>build</em> group associated with your build tag</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> koji add-group dist-foo-build build
</pre></div>
</div>
<ul class="simple">
<li><p>Populate the <em>build</em> group with packages that will be installed into
the minimal buildroot</p></li>
</ul>
<p>You can find out what the current build group for Fedora is by running
<code class="docutils literal notranslate"><span class="pre">koji</span> <span class="pre">-s</span> <span class="pre">https://koji.fedoraproject.org/kojihub</span> <span class="pre">list-groups</span> <span class="pre">f35-build</span></code>
against the Fedora Koji instance. This is probably a good
starting point for your minimal buildroot.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> koji add-group-pkg dist-foo-build build pkg1
<span class="gp">$</span> koji add-group-pkg dist-foo-build build pkg2
</pre></div>
</div>
<p>If you want to fully duplicate Fedora’s group data for a tag, then it would be
easier to do it in bulk – export Fedora’s data and import it to your build
tag.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> koji -s https://koji.fedoraproject.org/kojihub show-groups --comps f17-build &gt; comps.xml
<span class="gp">$</span> koji import-comps comps.xml dist-foo-build
</pre></div>
</div>
<ul class="simple">
<li><p>regenerate the repo</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> koji regen-repo dist-foo-build
</pre></div>
</div>
<ul class="simple">
<li><p>Wait for the repo to regenerate, and you should now be able to run a
build successfully.</p></li>
<li><p>Note, that you don’t need to run it manually but you can wait (if you’ve
Kojira correctly setup) when it will notice it and trigger the repo
regeneration. If you want to know when it will finish, you can use</p></li>
</ul>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> koji wait-repo dist-foo-build
</pre></div>
</div>
<p>…and now you’re set.</p>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="server_howto.html" class="btn btn-neutral float-left" title="Server Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="volumes.html" class="btn btn-neutral float-right" title="Storage Volumes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, Mike McLean, Mike B, Dennis Gilmore, Mathieu Bridon, Ian McLeod, Ralph Bean, Adam Miller.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>