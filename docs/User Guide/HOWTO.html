<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Introduction &mdash; Koji alpha documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Using Koji in Fedora" href="using_the_koji_build_system.html" />
    <link rel="prev" title="User Guide" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Koji
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Operations%20Guide/index.html">Operations Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Administration%20Guide/index.html">Administration Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Guide</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#getting-started">Getting started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#the-web-interface">The web interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-the-koji-cli">Installing the Koji cli</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-a-package">Building a package</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-options">Build Options</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-failures">Build Failures</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#koji-architecture">Koji Architecture</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#terminology">Terminology</a></li>
<li class="toctree-l3"><a class="reference internal" href="#koji-components">Koji Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="#package-organization">Package Organization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#exploring-koji">Exploring Koji</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="using_the_koji_build_system.html">Using Koji in Fedora</a></li>
<li class="toctree-l2"><a class="reference internal" href="using_the_koji_build_system.html#koji-xmlrpc-api">Koji XMLRPC API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Developer%20Guide/index.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../runs_here.html">Runs Here</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Koji</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">User Guide</a> &raquo;</li>
      <li>Introduction</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/User Guide/HOWTO.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline"></a></h1>
<p>Koji is a system for building and tracking RPMs. It was designed with
the following features in mind:</p>
<p><strong>Security</strong></p>
<ul class="simple">
<li><p>New buildroot for each build</p></li>
<li><p>nfs is used (mostly) read-only</p></li>
</ul>
<p><strong>Leverage other software</strong></p>
<ul class="simple">
<li><p>Uses Yum and Mock open-source components</p></li>
<li><p>XML-RPC APIs for easy integration with other tools</p></li>
</ul>
<p><strong>Flexibility</strong></p>
<ul class="simple">
<li><p>rich data model</p></li>
<li><p>active code base</p></li>
</ul>
<p><strong>Usability</strong></p>
<ul class="simple">
<li><p>Web interface with Kerberos authentication</p></li>
<li><p>Thin, portable client</p></li>
<li><p>Users can create local buildroots</p></li>
</ul>
<p><strong>Reproducibility</strong></p>
<ul class="simple">
<li><p>Buildroot contents are tracked in the database</p></li>
<li><p>Versioned data</p></li>
</ul>
<p>This HOWTO document covers the basic tasks that a developer needs to be
able to accomplish with Koji.</p>
</div>
<div class="section" id="getting-started">
<h1>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline"></a></h1>
<div class="section" id="the-web-interface">
<h2>The web interface<a class="headerlink" href="#the-web-interface" title="Permalink to this headline"></a></h2>
<p>The primary interface for viewing Koji data is a web application. Most
of the interface is read-only, but if you are logged in (see below) and
have sufficient privileges there are some actions that can be performed
though the web. For example:</p>
<ul class="simple">
<li><p>Cancel a build</p></li>
<li><p>Resubmit a failed task</p></li>
</ul>
<p>Those with admin privileges will find additional actions, such as:</p>
<ul class="simple">
<li><p>Create/Edit/Delete a tag</p></li>
<li><p>Create/Edit/Delete a target</p></li>
<li><p>Enable/Disable a build host</p></li>
</ul>
<p>The web site utilizes Kerberos authentication. In order to log in you
will need a valid Kerberos ticket and your web browser will need to be
configured to send the Kerberos information to the server.</p>
<p>In Firefox, you will need to use the <a class="reference external" href="about:config">about:config</a> page to set
a Kerberos parameter. Use the search term ‘negotiate’ to filter the list.
Change network.negotiate-auth.trusted-uris to the domain you want to
authenticate against, e.g .example.com. You can leave
network.negotiate-auth.delegation-uris blank, as it enables Kerberos
ticket passing, which is not required.</p>
<p>In order to obtain a Kerberos ticket, use the kinit command.</p>
</div>
<div class="section" id="installing-the-koji-cli">
<h2>Installing the Koji cli<a class="headerlink" href="#installing-the-koji-cli" title="Permalink to this headline"></a></h2>
<p>There is a single point of entry for most operations. The command is
called ‘koji’ and is included in the main koji package.</p>
<p>The koji tool authenticates to the central server using Kerberos, so you
will need to have a valid Kerberos ticket to use many features. However,
many of the read-only commands will work without authentication.</p>
</div>
<div class="section" id="building-a-package">
<h2>Building a package<a class="headerlink" href="#building-a-package" title="Permalink to this headline"></a></h2>
<p>Builds are initiated with the command line tool. To build a package, the
syntax is:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>koji build &lt;build target&gt; &lt;git URL&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>koji build f25 git://pkgs.fedoraproject.org/rpms/eclipse-jgit?#00ca55985303b1ce19c632922ebcca283ab6e296
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">koji</span> <span class="pre">build</span></code> command creates a build task in Koji. By default the
tool will wait and print status updates until the build completes. You
can override this with the <code class="docutils literal notranslate"><span class="pre">--nowait</span></code> option. To view other options to
the build command use the <code class="docutils literal notranslate"><span class="pre">--help</span></code> option.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>koji build --help
</pre></div>
</div>
</div>
<div class="section" id="build-options">
<h2>Build Options<a class="headerlink" href="#build-options" title="Permalink to this headline"></a></h2>
<p>There are a few options to the build command. Here are some more
detailed explanations of them:</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">--skip-tag</span></code></dt><dd><p>Normally the package is tagged after the build completes. This
option causes the tagging step to be skipped. The package will be in
the system, but untagged (you can later tag it with the tag-build
command)</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--scratch</span></code></dt><dd><p>This makes the build into a scratch build. The build will not be
imported into the db, it will just be built. The rpms will land
under &lt;topdir&gt;/scratch. Scratch builds are not tracked and can never
be tagged, but can be convenient for testing. Scratch builds are
typically removed from the filesystem after one week.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--nowait</span></code></dt><dd><p>As stated above, this prevents the cli from waiting on the build
task.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">--arch-override</span></code></dt><dd><p>This option allows you to override the base set of arches to build
for. This option is really only for testing during the beta period,
but it may be retained for scratch builds in the future.</p>
</dd>
</dl>
</div>
<div class="section" id="build-failures">
<h2>Build Failures<a class="headerlink" href="#build-failures" title="Permalink to this headline"></a></h2>
<p>If your package fails to build, you will see something like this.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">420066 buildArch (kernel-2.6.18-1.2739.10.9.el5.jjf.215394.2.src.rpm,</span>
<span class="go">ia64): open (build-1.example.com) -&gt; FAILED: BuildrootError:</span>
<span class="go">error building package (arch ia64), mock exited with status 10</span>
</pre></div>
</div>
<p>You can figure out why the build failed by looking at the log files. If
there is a build.log, start there. Otherwise, look at init.log</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ls -1 &lt;topdir&gt;/work/tasks/420066/*
<span class="go">&lt;topdir&gt;/work/tasks/420066/build.log</span>
<span class="go">&lt;topdir&gt;/work/tasks/420066/init.log</span>
<span class="go">&lt;topdir&gt;/work/tasks/420066/mockconfig.log</span>
<span class="go">&lt;topdir&gt;/work/tasks/420066/root.log</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="koji-architecture">
<h1>Koji Architecture<a class="headerlink" href="#koji-architecture" title="Permalink to this headline"></a></h1>
<div class="section" id="terminology">
<h2>Terminology<a class="headerlink" href="#terminology" title="Permalink to this headline"></a></h2>
<p>In Koji, it is sometimes necessary to distinguish between the a package
in general, a specific build of a package, and the various rpm files
created by a build. When precision is needed, these terms should be
interpreted as follows:</p>
<dl class="simple">
<dt>Package</dt><dd><p>The name of a source rpm. This refers to the package in general and
not any particular build or subpackage. For example: kernel, glibc,
etc.</p>
</dd>
<dt>Build</dt><dd><p>A particular build of a package. This refers to the entire build:
all arches and subpackages. For example: kernel-2.6.9-34.EL,
glibc-2.3.4-2.19.</p>
</dd>
<dt>RPM</dt><dd><p>A particular rpm. A specific arch and subpackage of a build. For
example: kernel-2.6.9-34.EL.x86_64, kernel-devel-2.6.9-34.EL.s390,
glibc-2.3.4-2.19.i686, glibc-common-2.3.4-2.19.ia64</p>
</dd>
</dl>
</div>
<div class="section" id="koji-components">
<h2>Koji Components<a class="headerlink" href="#koji-components" title="Permalink to this headline"></a></h2>
<p>Koji is comprised of several components:</p>
<ul>
<li><p><strong>koji-hub</strong> is the center of all Koji operations. It is an XML-RPC
server running under mod_wsgi in Apache. koji-hub is passive in
that it only receives XML-RPC calls and relies upon the build daemons
and other components to initiate communication. koji-hub is the only
component that has direct access to the database and is one of the
two components that have write access to the file system.</p></li>
<li><p><strong>kojid</strong> is the build daemon that runs on each of the build machines.
Its primary responsibility is polling for incoming build requests and
handling them accordingly. Koji also has support for tasks other than
building. Creating install images is one example. kojid is
responsible for handling these tasks as well.</p>
<p>kojid uses mock for building. It also creates a fresh buildroot for
every build. kojid is written in Python and communicates with
koji-hub via XML-RPC.</p>
</li>
<li><p><strong>koji-web</strong> is a set of scripts that run in mod_wsgi and use the
Cheetah templating engine to provide an web interface to Koji.
koji-web exposes a lot of information and also provides a means for
certain operations, such as cancelling builds.</p></li>
<li><p><strong>koji</strong> is a CLI written in Python that provides many hooks into Koji.
It allows the user to query much of the data as well as perform
actions such as build initiation.</p></li>
<li><p><strong>kojira</strong> is a daemon that keeps the build root repodata updated.</p></li>
</ul>
</div>
<div class="section" id="package-organization">
<h2>Package Organization<a class="headerlink" href="#package-organization" title="Permalink to this headline"></a></h2>
<p><strong>Tags and Targets</strong></p>
<p>Koji organizes packages using tags. In Koji a tag is roughly analogous
to a beehive collection instance, but differ in a number of ways:</p>
<ul class="simple">
<li><p>Tags are tracked in the database but not on disk</p></li>
<li><p>Tags support multiple inheritance</p></li>
<li><p>Each tag has its own list of valid packages (inheritable)</p></li>
<li><p>Package ownership can be set per-tag (inheritable)</p></li>
<li><p>Tag inheritance is more configurable</p></li>
<li><p>When you build you specify a <em>target</em> rather than a tag</p></li>
</ul>
<p>A build target specifies where a package should be built and how it
should be tagged afterwards. This allows target names to remain fixed as
tags change through releases. You can get a full list of build targets
with the following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>koji list-targets
</pre></div>
</div>
<p>You can see just a single target with the <code class="docutils literal notranslate"><span class="pre">--name</span></code> option:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>koji list-targets --name dist-fc7
<span class="go">Name                           Buildroot                      Destination</span>
<span class="go">---------------------------------------------------------------------------------------------</span>
<span class="go">dist-fc7                       dist-fc7-build                 dist-fc7</span>
</pre></div>
</div>
<p>This tells you a build for target dist-fc7 will use a buildroot with
packages from the tag dist-fc7-build and tag the resulting packages as
dist-fc7.</p>
<p>You can get a list of tags with the following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>koji list-tags
</pre></div>
</div>
<p><em>Package lists</em></p>
<p>As mentioned above, each tag has its own list of packages that may be
placed in the tag. To see that list for a tag, use the <code class="docutils literal notranslate"><span class="pre">list-pkgs</span></code>
command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>koji list-pkgs --tag dist-fc7
<span class="go">Package                 Tag                     Extra Arches     Owner</span>
<span class="go">----------------------- ----------------------- ---------------- ----------------</span>
<span class="go">ElectricFence           dist-fc6                                 pmachata</span>
<span class="go">GConf2                  dist-fc6                                 rstrode</span>
<span class="go">lucene                  dist-fc6                                 dbhole</span>
<span class="go">lvm2                    dist-fc6                                 lvm-team</span>
<span class="go">ImageMagick             dist-fc6                                 nmurray</span>
<span class="go">m17n-db                 dist-fc6                                 majain</span>
<span class="go">m17n-lib                dist-fc6                                 majain</span>
<span class="go">MAKEDEV                 dist-fc6                                 clumens</span>
<span class="go">...</span>
</pre></div>
</div>
<p>The first column is the name of the package, the second tells you which
tag the package entry has been inherited from, and the third tells you
the owner of the package.</p>
<p><strong>Latest Builds</strong></p>
<p>To see the latest builds for a tag, use the <code class="docutils literal notranslate"><span class="pre">latest-build</span></code> command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>koji latest-build --all dist-fc7
<span class="go">Build                                     Tag                   Built by</span>
<span class="go">----------------------------------------  --------------------  ----------------</span>
<span class="go">ConsoleKit-0.1.0-5.fc7                    dist-fc7              davidz</span>
<span class="go">ElectricFence-2.2.2-20.2.2                dist-fc6              jkeating</span>
<span class="go">GConf2-2.16.0-6.fc7                       dist-fc7              mclasen</span>
<span class="go">ImageMagick-6.2.8.0-3.fc6.1               dist-fc6-updates      nmurray</span>
<span class="go">MAKEDEV-3.23-1.2                          dist-fc6              nalin</span>
<span class="go">MySQL-python-1.2.1_p2-2                   dist-fc7              katzj</span>
<span class="go">NetworkManager-0.6.5-0.3.cvs20061025.fc7  dist-fc7              caillon</span>
<span class="go">ORBit2-2.14.6-1.fc7                       dist-fc7              mclasen</span>
</pre></div>
</div>
<p>The output gives you not only the latest builds, but which tag they have
been inherited from and who built them (note: for builds imported from
beehive the “built by” field may be misleading)</p>
</div>
<div class="section" id="exploring-koji">
<h2>Exploring Koji<a class="headerlink" href="#exploring-koji" title="Permalink to this headline"></a></h2>
<p>We’ve tried to make Koji self-documenting wherever possible. The command
line tool will print a list of valid commands and each command supports
<code class="docutils literal notranslate"><span class="pre">--help</span></code>. For example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>koji <span class="nb">help</span>
<span class="go">Koji commands are:</span>
<span class="go">        build                Build a package from source</span>
<span class="go">        cancel-task          Cancel a task</span>
<span class="go">        help                 List available commands</span>
<span class="go">        latest-build         Print the latest builds for a tag</span>
<span class="go">...</span>
<span class="gp">$ </span>koji build --help
<span class="go">usage: koji build [options] tag URL</span>
<span class="gp gp-VirtualEnv">(Specify the --help global option for a list of other help options)</span>

<span class="go">options:</span>
<span class="go">  -h, --help            show this help message and exit</span>
<span class="go">  --skip-tag            Do not attempt to tag package</span>
<span class="go">  --scratch             Perform a scratch build</span>
<span class="go">  --nowait              Don&#39;t wait on build</span>
<span class="go">...</span>
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="User Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="using_the_koji_build_system.html" class="btn btn-neutral float-right" title="Using Koji in Fedora" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, Mike McLean, Mike B, Dennis Gilmore, Mathieu Bridon, Ian McLeod, Ralph Bean, Adam Miller.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>