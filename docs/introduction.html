<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Introduction &mdash; Koji alpha documentation</title><link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Operations Guide" href="Operations Guide/index.html" />
    <link rel="prev" title="Welcome to Koji’s documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Koji
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#koji-architecture">Koji Architecture</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#terminology">Terminology</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#koji-components">Koji Components</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#koji-hub">Koji-Hub</a></li>
<li class="toctree-l3"><a class="reference internal" href="#kojid">Kojid</a></li>
<li class="toctree-l3"><a class="reference internal" href="#koji-web">Koji-Web</a></li>
<li class="toctree-l3"><a class="reference internal" href="#koji-client">Koji-client</a></li>
<li class="toctree-l3"><a class="reference internal" href="#kojira">Kojira</a></li>
<li class="toctree-l3"><a class="reference internal" href="#garbage-collector">Garbage Collector</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#package-organization">Package Organization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#tags-and-targets">Tags and Targets</a></li>
<li class="toctree-l3"><a class="reference internal" href="#package-lists">Package lists</a></li>
<li class="toctree-l3"><a class="reference internal" href="#latest-builds">Latest Builds</a></li>
<li class="toctree-l3"><a class="reference internal" href="#documentation">Documentation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Operations Guide/index.html">Operations Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="Administration Guide/index.html">Administration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="User Guide/index.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="Developer Guide/index.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="runs_here.html">Runs Here</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Koji</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Introduction</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/introduction.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="introduction">
<h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h1>
<div class="section" id="koji-architecture">
<h2>Koji Architecture<a class="headerlink" href="#koji-architecture" title="Permalink to this headline">¶</a></h2>
<div class="section" id="terminology">
<h3>Terminology<a class="headerlink" href="#terminology" title="Permalink to this headline">¶</a></h3>
<p>In Koji it is sometimes necessary to distinguish between a package in general,
a specific build of a package, and the various rpm files created by a build.
When precision is needed, these terms should be interpreted as follows:</p>
<dl class="simple">
<dt>Package</dt><dd><p>The name of a source rpm. This refers to the package in general and not
any particular build or subpackage. For example: kernel, glibc, etc.</p>
</dd>
<dt>Build</dt><dd><p>A particular build of a package. This refers to the entire build: all
arches and subpackages. For example: kernel-2.6.9-34.EL, glibc-2.3.4-2.19.</p>
</dd>
<dt>RPM</dt><dd><p>A particular rpm. A specific arch and subpackage of a build. For example:
kernel-2.6.9-34.EL.x86_64, kernel-devel-2.6.9-34.EL.s390,
glibc-2.3.4-2.19.i686, glibc-common-2.3.4-2.19.ia64</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="koji-components">
<h2>Koji Components<a class="headerlink" href="#koji-components" title="Permalink to this headline">¶</a></h2>
<div class="figure align-default">
<a class="reference internal image-reference" href="_images/koji_structure1.svg"><img alt="Koji component structure diagram" height="371.0" src="_images/koji_structure1.svg" width="535.0" /></a>
</div>
<p>Koji is comprised of several components:</p>
<div class="section" id="koji-hub">
<h3>Koji-Hub<a class="headerlink" href="#koji-hub" title="Permalink to this headline">¶</a></h3>
<p>koji-hub is the center of all Koji operations. It is an XML-RPC server running
under mod_wsgi in Apache. koji-hub is passive in that it only receives XML-RPC
calls and relies upon the build daemons and other components to initiate
communication. koji-hub is the only component that has direct access to the
database and is one of the two components that have write access to the file
system.</p>
</div>
<div class="section" id="kojid">
<h3>Kojid<a class="headerlink" href="#kojid" title="Permalink to this headline">¶</a></h3>
<p>kojid is the build daemon that runs on each of the build machines. Its primary
responsibility is polling for incoming build requests and handling them
accordingly. Essentially kojid asks koji-hub for work. Koji also has support
for tasks other than building. Creating install images is one example. kojid
is responsible for handling these tasks as well. kojid uses mock for building.
It also creates a fresh buildroot for every build. kojid is written in Python
and communicates with koji-hub via XML-RPC.</p>
</div>
<div class="section" id="koji-web">
<h3>Koji-Web<a class="headerlink" href="#koji-web" title="Permalink to this headline">¶</a></h3>
<p>koji-web is a set of scripts that run in mod_wsgi and use the Cheetah
templating engine to provide a web interface to Koji. It acts as a client to
koji-hub providing a visual interface to perform a limited amount of
administration. koji-web exposes a lot of information and also provides a means
for certain operations, such as cancelling builds.</p>
</div>
<div class="section" id="koji-client">
<h3>Koji-client<a class="headerlink" href="#koji-client" title="Permalink to this headline">¶</a></h3>
<p>koji-client is a CLI written in Python that provides many hooks into Koji. It
allows the user to query much of the data as well as perform actions such as
adding users and initiating build requests.</p>
</div>
<div class="section" id="kojira">
<h3>Kojira<a class="headerlink" href="#kojira" title="Permalink to this headline">¶</a></h3>
<p>kojira is a daemon that keeps the build root repodata updated. It is
responsible for removing redundant build roots and cleaning up after a build
request is completed.</p>
</div>
<div class="section" id="garbage-collector">
<h3>Garbage Collector<a class="headerlink" href="#garbage-collector" title="Permalink to this headline">¶</a></h3>
<p>koji-gc is a single script (runnable via cron or similar means) which is
responsible for pruning the koji produced content (e.g. testing builds and
everything what is no more needed)</p>
</div>
</div>
<div class="section" id="package-organization">
<h2>Package Organization<a class="headerlink" href="#package-organization" title="Permalink to this headline">¶</a></h2>
<div class="section" id="tags-and-targets">
<h3>Tags and Targets<a class="headerlink" href="#tags-and-targets" title="Permalink to this headline">¶</a></h3>
<p>Koji organizes packages using tags:</p>
<ul class="simple">
<li><p>Tags are tracked in the database but not on disk</p></li>
<li><p>Tags support multiple inheritance</p></li>
<li><p>Each tag has its own list of valid packages (inheritable)</p></li>
<li><p>Package ownership can be set per-tag (inheritable)</p></li>
<li><p>Tag inheritance is more configurable</p></li>
<li><p>When you build you specify a target rather than a tag</p></li>
</ul>
<p>A build target specifies where a package should be built and how it should be
tagged afterwards. This allows target names to remain fixed as tags change
through releases. You can get a full list of build targets with the following
command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> koji list-targets
</pre></div>
</div>
<p>You can see just a single target with the –name option:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> koji list-targets --name dist-fc7

<span class="go">Name                           Buildroot                      Destination</span>
<span class="go">---------------------------------------------------------------------------------------------</span>
<span class="go">dist-fc7                       dist-fc7-build                 dist-fc7</span>
</pre></div>
</div>
<p>This tells you a build for target dist-fc7 will use a buildroot with packages
from the tag dist-fc7-build and tag the resulting packages as dist-fc7.</p>
<p>You can get a list of tags with the following command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> koji list-tags
</pre></div>
</div>
</div>
<div class="section" id="package-lists">
<h3>Package lists<a class="headerlink" href="#package-lists" title="Permalink to this headline">¶</a></h3>
<p>As mentioned above, each tag has its own list of packages that may be placed in
the tag. To see that list for a tag, use the list-pkgs command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> koji list-pkgs --tag dist-fc7

<span class="go">Package                 Tag                     Extra Arches     Owner</span>
<span class="go">----------------------- ----------------------- ---------------- ----------------</span>
<span class="go">ElectricFence           dist-fc6                                 pmachata</span>
<span class="go">GConf2                  dist-fc6                                 rstrode</span>
<span class="go">lucene                  dist-fc6                                 dbhole</span>
<span class="go">lvm2                    dist-fc6                                 lvm-team</span>
<span class="go">ImageMagick             dist-fc6                                 nmurray</span>
<span class="go">m17n-db                 dist-fc6                                 majain</span>
<span class="go">m17n-lib                dist-fc6                                 majain</span>
<span class="go">MAKEDEV                 dist-fc6                                 clumens</span>
<span class="go">[...]</span>
</pre></div>
</div>
<p>The first column is the name of the package, the second tells you which tag the
package entry has been inherited from, and the third tells you the owner of the
package.</p>
</div>
<div class="section" id="latest-builds">
<h3>Latest Builds<a class="headerlink" href="#latest-builds" title="Permalink to this headline">¶</a></h3>
<p>To see the latest builds for a tag, use the latest-build command:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> koji latest-build --all dist-fc7

<span class="go">Build                                     Tag                   Built by</span>
<span class="go">----------------------------------------  --------------------  ----------------</span>
<span class="go">ConsoleKit-0.1.0-5.fc7                    dist-fc7              davidz</span>
<span class="go">ElectricFence-2.2.2-20.2.2                dist-fc6              jkeating</span>
<span class="go">GConf2-2.16.0-6.fc7                       dist-fc7              mclasen</span>
<span class="go">ImageMagick-6.2.8.0-3.fc6.1               dist-fc6-updates      nmurray</span>
<span class="go">MAKEDEV-3.23-1.2                          dist-fc6              nalin</span>
<span class="go">MySQL-python-1.2.1_p2-2                   dist-fc7              katzj</span>
<span class="go">NetworkManager-0.6.5-0.3.cvs20061025.fc7  dist-fc7              caillon</span>
<span class="go">ORBit2-2.14.6-1.fc7                       dist-fc7              mclasen</span>
</pre></div>
</div>
<p>The output gives you not only the latest builds, but which tag they have been
inherited from and who built them (note: for builds imported from beehive the
“built by” field may be misleading).</p>
</div>
<div class="section" id="documentation">
<h3>Documentation<a class="headerlink" href="#documentation" title="Permalink to this headline">¶</a></h3>
<p>We’ve tried to make Koji self-documenting wherever possible. The command line
tool will print a list of valid commands and each command supports –help.
For example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> koji <span class="nb">help</span>

<span class="go">Koji commands are:</span>
<span class="go">build                Build a package from source</span>
<span class="go">cancel-task          Cancel a task</span>
<span class="go">help                 List available commands</span>
<span class="go">latest-build         Print the latest builds for a tag</span>
<span class="go">[...]</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> koji build --help

<span class="go">usage: koji build [options]  tag URL</span>
<span class="gp gp-VirtualEnv">(Specify the --help global option for a list of other help options)</span>

<span class="go">options:</span>
<span class="go">-h, --help            show this help message and exit</span>
<span class="go">--skip-tag            Do not attempt to tag package</span>
<span class="go">--scratch             Perform a scratch build</span>
<span class="go">--nowait              Don&#39;t wait on build</span>
<span class="go">[...]</span>
</pre></div>
</div>
<p>You can see administrator-only command help with –admin. Most users will
never use these additional commands, but if you’re setting up your own Koji
system, you may find them very useful.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> koji <span class="nb">help</span> --admin
<span class="go">Available commands:</span>
<span class="go">        add-external-repo         Create an external repo and/or add one to a tag</span>
<span class="go">        add-group                 Add a group to a tag</span>
<span class="go">        add-group-pkg             Add a package to a group&#39;s package listing</span>
<span class="go">[...]</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to Koji’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Operations Guide/index.html" class="btn btn-neutral float-right" title="Operations Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017, Mike McLean, Mike B, Dennis Gilmore, Mathieu Bridon, Ian McLeod, Ralph Bean, Adam Miller.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>